<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>日志查看器</title>
    <!-- 样式从扩展侧注入真实路径，这里使用占位符 -->
    <link rel="stylesheet" href="%%WEBVIEW_CSS%%">
</head>
<body>
    <div class="toolbar">
        <div class="file-info">
            <div><strong>文件:</strong> <span id="fileName">未加载</span></div>
            <div class="stats">
                <span><strong>大小:</strong> <span id="fileSize">0</span>MB</span>
                <span style="margin-left: 15px;"><strong>总行数:</strong> <span id="totalLines">0</span></span>
                <span style="margin-left: 15px;"><strong>已加载:</strong> <span id="loadedLines">0</span></span>
            </div>
        </div>
        <div class="search-box">
            <input type="text" id="searchInput" placeholder="搜索日志内容...">
            <label style="font-size: 12px; display: flex; align-items: center; gap: 5px;">
                <input type="checkbox" id="regexMode">
                <span>正则</span>
            </label>
            <label style="font-size: 12px; display: flex; align-items: center; gap: 5px;">
                <input type="checkbox" id="multipleMode">
                <span>多关键词</span>
            </label>
            <label style="font-size: 12px; display: flex; align-items: center; gap: 5px;">
                <input type="checkbox" id="reverseMode">
                <span>反向搜索</span>
            </label>
            <button onclick="search()">🔍 搜索</button>
            <button onclick="showAdvancedSearchModal()">🔍 高级搜索</button>
            <button onclick="showJumpDialog()">🎯 定位</button>
            <button onclick="showBookmarksModal()">📌 书签</button>
            <button onclick="showCommentsModal()">📝 注释</button>
            <button onclick="showCustomHighlightModal()">🎨 高亮规则</button>
            <button onclick="showSettingsModal()">⚙ 设置</button>
            <div class="dropdown">
                <button onclick="toggleMoreMenu()">⋯ 更多</button>
                <div class="dropdown-content" id="moreMenu">
                    <button onclick="showStats(); closeMoreMenu();">📈 统计</button>
                    <button onclick="exportLogs(); closeMoreMenu();">💾 导出</button>
                    <button onclick="showDeleteModal(); closeMoreMenu();">🗑️ 删除</button>
                </div>
            </div>
            <button onclick="refresh()">🔄 刷新</button>
        </div>
    </div>
    
    <div class="filter-panel">
        <span style="font-size: 12px; font-weight: bold;">日志级别:</span>
        <div class="checkbox-group">
            <label style="font-weight: bold; color: var(--vscode-button-background);">
                <input type="checkbox" id="filterAll" checked onchange="toggleAll()">
                <span>✔️ 全选</span>
            </label>
            <span style="width: 1px; height: 20px; background-color: var(--vscode-panel-border); margin: 0 5px;"></span>
            <label>
                <input type="checkbox" id="filterError" checked onchange="applyFilter()">
                <span style="color: #f14c4c; font-weight: bold;">■</span> ERROR
            </label>
            <label>
                <input type="checkbox" id="filterWarn" checked onchange="applyFilter()">
                <span style="color: #cca700; font-weight: bold;">■</span> WARN
            </label>
            <label>
                <input type="checkbox" id="filterInfo" checked onchange="applyFilter()">
                <span style="color: #4fc1ff; font-weight: bold;">■</span> INFO
            </label>
            <label>
                <input type="checkbox" id="filterDebug" checked onchange="applyFilter()">
                <span style="color: #b267e6; font-weight: bold;">■</span> DEBUG
            </label>
            <label><input type="checkbox" id="filterOther" checked onchange="applyFilter()"> 其他</label>
        </div>
        <span style="width: 1px; height: 20px; background-color: var(--vscode-panel-border); margin: 0 10px;"></span>
        <label style="font-size: 12px; display: flex; align-items: center; gap: 5px; cursor: pointer;">
            <input type="checkbox" id="collapseRepeated" onchange="toggleCollapseMode()">
            <span>📎 折叠重复日志</span>
        </label>
        <label style="font-size: 12px; display: flex; align-items: center; gap: 5px; cursor: pointer;">
            <input type="checkbox" id="enableJsonParse" checked onchange="toggleJsonParse()">
            <span>🌲 解析JSON/XML</span>
        </label>
    </div>
    
    <!-- 筛选状态提示 -->
    <div class="filter-status-panel" id="filterStatusPanel" style="display: none;">
        <span style="font-size: 12px; font-weight: bold;">🔍 正在筛选：</span>
        <span id="filterStatusText" style="font-size: 12px; color: var(--vscode-textLink-foreground); font-weight: 500;"></span>
        <button onclick="clearCustomFilter()" style="padding: 3px 10px; font-size: 11px; margin-left: 10px;">❌ 取消筛选</button>
    </div>
    
    <!-- 时间线导航 -->
    <div class="timeline-panel" id="timelinePanel" style="display: none;">
        <div class="timeline-header" onclick="toggleTimeline()">
            <span style="font-weight: bold; font-size: 12px;">📈 时间线导航</span>
            <span id="timelineToggleIcon" style="font-size: 12px;">▼</span>
        </div>
        <div class="timeline-content" id="timelineContent">
            <canvas id="timelineCanvas" width="100%" height="80"></canvas>
            <div id="timelineInfo" style="font-size: 11px; color: var(--vscode-descriptionForeground); margin-top: 5px; text-align: center;">
                <!-- 时间范围信息 -->
            </div>
        </div>
    </div>
    
    <div class="log-container" id="logContainer">
        <div class="loading">等待加载日志文件...</div>
    </div>
    
    <!-- 分页控件 -->
    <div class="pagination" id="pagination" style="display: none;">
        <button onclick="goToFirstPage()" id="firstPageBtn">⏮️ 首页</button>
        <button onclick="goToPrevPage()" id="prevPageBtn">◀️ 上一页</button>
        <span class="page-info">
            第 <input type="number" id="currentPageInput" min="1" value="1" onchange="goToPage(this.value)"> 
            / <span id="totalPages">1</span> 页
        </span>
        <button onclick="goToNextPage()" id="nextPageBtn">下一页 ▶️</button>
        <button onclick="goToLastPage()" id="lastPageBtn">末页 ⏭️</button>
        <span class="page-info" style="margin-left: 20px;">
            <span style="font-size: 14px; font-weight: 600;">每页显示：</span>
            <select id="pageSizeSelect" onchange="changePageSize(this.value)">
                <option value="50">50</option>
                <option value="100" selected>100</option>
                <option value="200">200</option>
                <option value="500">500</option>
                <option value="1000">1000</option>
            </select>
            <span style="font-size: 14px; font-weight: 600;">行</span>
        </span>
        <span class="page-info">
            <span id="lineRangeInfo" style="display: none;">第 <span id="lineRangeStart">0</span> - <span id="lineRangeEnd">0</span> 行 / </span>共 <span id="totalLinesInPage">0</span> 行
        </span>
    </div>
    
    <!-- 统计弹窗 -->
    <div id="statsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>日志统计信息</h2>
                <span class="modal-close" onclick="closeStatsModal()">&times;</span>
            </div>
            <div class="modal-body">
                <div class="stats-grid" id="statsGrid">
                    <!-- 统计信息将动态生成 -->
                </div>
            </div>
        </div>
    </div>
    
    <!-- 按时间删除弹窗 -->
    <div id="deleteByTimeModal" class="modal">
        <div class="modal-content">
            <span class="modal-close" onclick="closeDeleteByTimeModal()">&times;</span>
            <h2>⏰ 按时间删除日志</h2>
            <div style="margin-top: 20px;">
                <div style="margin-bottom: 15px;">
                    <label style="display: block; margin-bottom: 5px; font-weight: bold;">删除模式：</label>
                    <select id="deleteTimeMode" style="width: 100%; padding: 8px; background-color: var(--vscode-input-background); color: var(--vscode-input-foreground); border: 1px solid var(--vscode-input-border); border-radius: 3px;">
                        <option value="before">删除指定时间之前的日志</option>
                        <option value="after">删除指定时间之后的日志</option>
                    </select>
                </div>
                <div style="margin-bottom: 15px;">
                    <label style="display: block; margin-bottom: 5px; font-weight: bold;">时间（支持格式：2024-01-01 12:00:00 或 2024-01-01）：</label>
                    <input type="text" id="deleteTimeInput" placeholder="例如：2024-01-01 12:00:00" style="width: 100%; padding: 8px; background-color: var(--vscode-input-background); color: var(--vscode-input-foreground); border: 1px solid var(--vscode-input-border); border-radius: 3px;">
                </div>
                <div style="background-color: var(--vscode-editorWidget-background); padding: 10px; border-radius: 3px; margin-bottom: 15px; border-left: 3px solid #d97706;">
                    <strong>⚠️ 警告：</strong>此操作会直接修改原文件，不可恢复！请务必备份重要日志！
                </div>
                <div style="display: flex; gap: 10px; justify-content: flex-end;">
                    <button onclick="closeDeleteByTimeModal()">取消</button>
                    <button onclick="confirmDeleteByTime()">确认删除</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- 删除方式选择弹窗 -->
    <div id="deleteModal" class="modal">
        <div class="modal-content" style="max-width: 400px;">
            <div class="modal-header">
                <h2>🗑️ 删除日志</h2>
                <span class="modal-close" onclick="closeDeleteModal()">&times;</span>
            </div>
            <div class="modal-body">
                <div style="display: grid; gap: 15px;">
                    <button onclick="selectDeleteByTime()" style="padding: 15px; display: flex; align-items: center; gap: 10px; font-size: 14px;">
                        <span style="font-size: 20px;">⏰</span>
                        <div style="text-align: left;">
                            <div style="font-weight: bold;">按时间删除</div>
                            <div style="font-size: 11px; opacity: 0.9; margin-top: 3px;">删除指定时间之前/之后的日志</div>
                        </div>
                    </button>
                    <button onclick="selectDeleteByLine()" style="padding: 15px; display: flex; align-items: center; gap: 10px; font-size: 14px;">
                        <span style="font-size: 20px;">📊</span>
                        <div style="text-align: left;">
                            <div style="font-weight: bold;">按行数删除</div>
                            <div style="font-size: 11px; opacity: 0.9; margin-top: 3px;">删除指定行之前/之后的日志</div>
                        </div>
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- 按行数删除弹窗 -->
    <div id="deleteByLineModal" class="modal">
        <div class="modal-content">
            <span class="modal-close" onclick="closeDeleteByLineModal()">&times;</span>
            <h2>📊 按行数删除日志</h2>
            <div style="margin-top: 20px;">
                <div style="margin-bottom: 15px;">
                    <label style="display: block; margin-bottom: 5px; font-weight: bold;">删除模式：</label>
                    <select id="deleteLineMode" style="width: 100%; padding: 8px; background-color: var(--vscode-input-background); color: var(--vscode-input-foreground); border: 1px solid var(--vscode-input-border); border-radius: 3px;">
                        <option value="before">删除指定行之前的日志</option>
                        <option value="after">删除指定行之后的日志</option>
                    </select>
                </div>
                <div style="margin-bottom: 15px;">
                    <label style="display: block; margin-bottom: 5px; font-weight: bold;">行号（从1开始）：</label>
                    <input type="number" id="deleteLineInput" placeholder="例如：1000" min="1" style="width: 100%; padding: 8px; background-color: var(--vscode-input-background); color: var(--vscode-input-foreground); border: 1px solid var(--vscode-input-border); border-radius: 3px;">
                </div>
                <div style="background-color: var(--vscode-editorWidget-background); padding: 10px; border-radius: 3px; margin-bottom: 15px; border-left: 3px solid #dc2626;">
                    <strong>⚠️ 警告：</strong>此操作会直接修改原文件，不可恢复！请务必备份重要日志！
                </div>
                <div style="display: flex; gap: 10px; justify-content: flex-end;">
                    <button onclick="closeDeleteByLineModal()">取消</button>
                    <button onclick="confirmDeleteByLine()">确认删除</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- 快速定位弹窗 -->
    <div id="jumpModal" class="modal">
        <div class="modal-content" style="max-width: 500px;">
            <div class="modal-header">
                <h2>🎯 快速定位</h2>
                <span class="modal-close" onclick="closeJumpModal()">&times;</span>
            </div>
            <div class="modal-body">
                <div style="margin-bottom: 20px;">
                    <label style="display: block; margin-bottom: 5px; font-weight: bold;">定位方式：</label>
                    <select id="jumpMode" onchange="switchJumpMode()" style="width: 100%; padding: 8px; background-color: var(--vscode-input-background); color: var(--vscode-input-foreground); border: 1px solid var(--vscode-input-border); border-radius: 3px; font-size: 13px;">
                        <option value="line">📍 按行号定位</option>
                        <option value="time">⏰ 按时间定位</option>
                    </select>
                </div>
                <div id="jumpByLineSection">
                    <div style="margin-bottom: 15px;">
                        <label style="display: block; margin-bottom: 5px; font-weight: bold;">行号（从1开始）：</label>
                        <input type="number" id="jumpLineInput" placeholder="例如：1000" min="1" style="width: 100%; padding: 8px; background-color: var(--vscode-input-background); color: var(--vscode-input-foreground); border: 1px solid var(--vscode-input-border); border-radius: 3px;">
                    </div>
                </div>
                <div id="jumpByTimeSection" style="display: none;">
                    <div style="margin-bottom: 15px;">
                        <label style="display: block; margin-bottom: 5px; font-weight: bold;">时间：</label>
                        <input type="datetime-local" id="jumpTimeInput" style="width: 100%; padding: 8px; background-color: var(--vscode-input-background); color: var(--vscode-input-foreground); border: 1px solid var(--vscode-input-border); border-radius: 3px;">
                        <div style="font-size: 11px; color: var(--vscode-descriptionForeground); margin-top: 5px;">💡 提示：支持直接输入或点击日历图标选择</div>
                    </div>
                </div>
                <div style="background-color: var(--vscode-editorWidget-background); padding: 10px; border-radius: 3px; margin-bottom: 15px; border-left: 3px solid #0e7490;">
                    <strong>💡 提示：</strong>定位后将自动跳转到对应的页面并高亮显示
                </div>
                <div style="display: flex; gap: 10px; justify-content: flex-end;">
                    <button onclick="closeJumpModal()">取消</button>
                    <button onclick="confirmJump()">定位</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- 书签管理弹窗 -->
    <div id="bookmarksModal" class="modal">
        <div class="modal-content" style="max-width: 700px;">
            <div class="modal-header">
                <h2>📌 书签列表</h2>
                <span class="modal-close" onclick="closeBookmarksModal()">&times;</span>
            </div>
            <div class="modal-body">
                <div id="bookmarksList" style="max-height: 400px; overflow-y: auto;">
                    <!-- 书签将动态生成 -->
                </div>
                <div style="margin-top: 15px; text-align: center; color: var(--vscode-descriptionForeground); font-size: 12px;">
                    💡 提示：双击日志行可添加/移除书签
                </div>
            </div>
        </div>
    </div>
    
    <!-- 注释管理弹窗 -->
    <div id="commentsModal" class="modal">
        <div class="modal-content" style="max-width: 800px;">
            <div class="modal-header">
                <h2>📝 注释列表</h2>
                <span class="modal-close" onclick="closeCommentsModal()">&times;</span>
            </div>
            <div class="modal-body">
                <div id="commentsList" style="max-height: 400px; overflow-y: auto;">
                    <!-- 注释将动态生成 -->
                </div>
                <div style="margin-top: 15px; text-align: center; color: var(--vscode-descriptionForeground); font-size: 12px;">
                    💡 提示：右键点击日志行可添加注释
                </div>
            </div>
        </div>
    </div>
    
    <!-- 添加/编辑注释弹窗 -->
    <div id="commentInputModal" class="modal">
        <div class="modal-content" style="max-width: 600px;">
            <div class="modal-header">
                <h2 id="commentInputTitle">📝 添加注释</h2>
                <span class="modal-close" onclick="closeCommentInputModal()">&times;</span>
            </div>
            <div class="modal-body">
                <div style="margin-bottom: 15px;">
                    <div style="font-weight: bold; margin-bottom: 5px;">行号：<span id="commentInputLineNumber"></span></div>
                    <div style="font-size: 12px; color: var(--vscode-descriptionForeground); font-family: 'Consolas', monospace; background-color: var(--vscode-editorWidget-background); padding: 8px; border-radius: 3px; margin-bottom: 10px; max-height: 60px; overflow-y: auto;" id="commentInputPreview"></div>
                </div>
                <div style="margin-bottom: 15px;">
                    <label style="display: block; margin-bottom: 5px; font-weight: bold;">注释内容：</label>
                    <textarea id="commentInputText" rows="4" style="width: 100%; padding: 8px; background-color: var(--vscode-input-background); color: var(--vscode-input-foreground); border: 1px solid var(--vscode-input-border); border-radius: 3px; font-family: inherit; resize: vertical;" placeholder="请输入注释内容..." onkeydown="if(event.ctrlKey && event.key === 'Enter') confirmCommentInput();"></textarea>
                    <div style="font-size: 11px; color: var(--vscode-descriptionForeground); margin-top: 5px;">💡 提示：按 Ctrl+Enter 快速保存</div>
                </div>
                <div style="display: flex; gap: 10px; justify-content: flex-end;">
                    <button onclick="closeCommentInputModal()">取消</button>
                    <button onclick="confirmCommentInput()">确定</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- 高级搜索弹窗 -->
    <div id="advancedSearchModal" class="modal">
        <div class="modal-content" style="max-width: 600px;">
            <div class="modal-header">
                <h2>🔍 高级搜索</h2>
                <span class="modal-close" onclick="closeAdvancedSearchModal()">&times;</span>
            </div>
            <div class="modal-body">
                <div style="margin-bottom: 15px;">
                    <label style="display: block; margin-bottom: 5px; font-weight: bold;">关键词：</label>
                    <input type="text" id="advSearchKeyword" placeholder="输入搜索关键词" style="width: 100%; padding: 8px; background-color: var(--vscode-input-background); color: var(--vscode-input-foreground); border: 1px solid var(--vscode-input-border); border-radius: 3px;">
                </div>
                <div style="margin-bottom: 15px;">
                    <label style="display: block; margin-bottom: 5px; font-weight: bold;">时间范围：</label>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                        <input type="text" id="advSearchStartTime" placeholder="开始时间 (2024-01-01 10:00:00)" style="padding: 8px; background-color: var(--vscode-input-background); color: var(--vscode-input-foreground); border: 1px solid var(--vscode-input-border); border-radius: 3px;">
                        <input type="text" id="advSearchEndTime" placeholder="结束时间 (2024-01-01 18:00:00)" style="padding: 8px; background-color: var(--vscode-input-background); color: var(--vscode-input-foreground); border: 1px solid var(--vscode-input-border); border-radius: 3px;">
                    </div>
                </div>
                <div style="margin-bottom: 15px;">
                    <label style="display: block; margin-bottom: 5px; font-weight: bold;">日志级别：</label>
                    <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                        <label><input type="checkbox" id="advSearchError" checked> <span style="color: #f14c4c;">■</span> ERROR</label>
                        <label><input type="checkbox" id="advSearchWarn" checked> <span style="color: #cca700;">■</span> WARN</label>
                        <label><input type="checkbox" id="advSearchInfo" checked> <span style="color: #4fc1ff;">■</span> INFO</label>
                        <label><input type="checkbox" id="advSearchDebug" checked> <span style="color: #b267e6;">■</span> DEBUG</label>
                        <label><input type="checkbox" id="advSearchOther" checked> 其他</label>
                    </div>
                </div>
                <div style="background-color: var(--vscode-editorWidget-background); padding: 10px; border-radius: 3px; margin-bottom: 15px; border-left: 3px solid #0e7490;">
                    <strong>💡 提示：</strong>可以单独使用关键词、时间范围或级别，也可以组合使用
                </div>
                <div style="display: flex; gap: 10px; justify-content: flex-end;">
                    <button onclick="closeAdvancedSearchModal()">取消</button>
                    <button onclick="confirmAdvancedSearch()">搜索</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- 自定义高亮规则弹窗 -->
    <div id="customHighlightModal" class="modal">
        <div class="modal-content" style="max-width: 800px;">
            <div class="modal-header">
                <h2>🎨 自定义高亮规则</h2>
                <span class="modal-close" onclick="closeCustomHighlightModal()">&times;</span>
            </div>
            <div class="modal-body">
                <div style="margin-bottom: 20px;">
                    <button onclick="showAddRuleDialog()" style="width: 100%; padding: 12px; font-weight: bold;">➕ 添加新规则</button>
                </div>
                <div id="highlightRulesList" style="max-height: 500px; overflow-y: auto;">
                    <!-- 规则列表将动态生成 -->
                </div>
            </div>
        </div>

        <!-- 设置面板 -->
        <div id="settingsModal" class="modal">
            <div class="modal-content small">
                <div class="modal-header">
                    <h3>⚙ 日志查看设置</h3>
                    <button class="close-button" onclick="closeSettingsModal()">✕</button>
                </div>
                <div class="modal-body">
                    <div class="form-group">
                        <label for="settingSearchDebounce">搜索防抖时间（毫秒）</label>
                        <input type="number" id="settingSearchDebounce" min="0" step="50">
                        <div class="hint">输入停止后等待多久自动触发搜索，值越大越省资源，但响应越慢。</div>
                    </div>
                    <div class="form-group">
                        <label for="settingCollapseMinRepeat">折叠最小重复次数</label>
                        <input type="number" id="settingCollapseMinRepeat" min="1" step="1">
                        <div class="hint">连续重复达到多少次时才会被折叠（默认 2 次）。</div>
                    </div>
                    <div class="form-group">
                        <label for="settingTimelineSample">时间线采样点数</label>
                        <input type="number" id="settingTimelineSample" min="20" max="1000" step="10">
                        <div class="hint">用于生成时间线的采样点数量，建议 100~400 之间。</div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button onclick="closeSettingsModal()">取消</button>
                    <button onclick="saveSettings()">保存</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- 添加/编辑高亮规则弹窗 -->
    <div id="addRuleModal" class="modal">
        <div class="modal-content" style="max-width: 600px;">
            <div class="modal-header">
                <h2 id="ruleModalTitle">➕ 添加高亮规则</h2>
                <span class="modal-close" onclick="closeAddRuleModal()">&times;</span>
            </div>
            <div class="modal-body">
                <div style="margin-bottom: 15px;">
                    <label style="display: block; margin-bottom: 5px; font-weight: bold;">规则名称：</label>
                    <input type="text" id="ruleName" placeholder="例如：API调用、错误代码" style="width: 100%; padding: 8px; background-color: var(--vscode-input-background); color: var(--vscode-input-foreground); border: 1px solid var(--vscode-input-border); border-radius: 3px;">
                </div>
                <div style="margin-bottom: 15px;">
                    <label style="display: block; margin-bottom: 5px; font-weight: bold;">匹配模式：</label>
                    <select id="ruleType" style="width: 100%; padding: 8px; background-color: var(--vscode-input-background); color: var(--vscode-input-foreground); border: 1px solid var(--vscode-input-border); border-radius: 3px;">
                        <option value="text">文本匹配</option>
                        <option value="regex">正则表达式</option>
                    </select>
                </div>
                <div style="margin-bottom: 15px;">
                    <label style="display: block; margin-bottom: 5px; font-weight: bold;">匹配内容：</label>
                    <input type="text" id="rulePattern" placeholder="例如：API或 \\bERROR\\b" style="width: 100%; padding: 8px; background-color: var(--vscode-input-background); color: var(--vscode-input-foreground); border: 1px solid var(--vscode-input-border); border-radius: 3px;">
                </div>
                <div style="margin-bottom: 15px;">
                    <label style="display: block; margin-bottom: 5px; font-weight: bold;">高亮颜色：</label>
                    <div style="display: flex; gap: 10px; align-items: center;">
                        <input type="color" id="ruleBgColor" value="#10b981" style="width: 80px; height: 40px; border: none; cursor: pointer;">
                        <input type="color" id="ruleTextColor" value="#ffffff" style="width: 80px; height: 40px; border: none; cursor: pointer;">
                        <div style="flex: 1;">
                            <div style="font-size: 11px; color: var(--vscode-descriptionForeground);">预览：</div>
                            <div id="colorPreview" style="display: inline-block; padding: 4px 8px; border-radius: 3px; background-color: #10b981; color: #ffffff; font-weight: 500;">示例文本</div>
                        </div>
                    </div>
                </div>
                <div style="margin-bottom: 15px;">
                    <label style="display: flex; align-items: center; gap: 5px; cursor: pointer;">
                        <input type="checkbox" id="ruleEnabled" checked>
                        <span>启用此规则</span>
                    </label>
                </div>
                <div style="background-color: var(--vscode-editorWidget-background); padding: 10px; border-radius: 3px; margin-bottom: 15px; border-left: 3px solid #8b5cf6;">
                    <strong>💡 提示：</strong>正则表达式示例：<code>\\b\w+:\\d+\\b</code> 匹配方法名:line号
                </div>
                <div style="display: flex; gap: 10px; justify-content: flex-end;">
                    <button onclick="closeAddRuleModal()">取消</button>
                    <button onclick="saveHighlightRule()">保存</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 脚本从扩展侧注入真实路径，这里使用占位符 -->
    <script src="%%WEBVIEW_JS%%"></script>
</body>
</html>
