<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ—¥å¿—æŸ¥çœ‹å™¨</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--vscode-editor-background);
            color: var(--vscode-editor-foreground);
            padding: 10px;
            overflow: hidden;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }
        
        .toolbar {
            background-color: var(--vscode-editorWidget-background);
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 10px;
            display: flex;
            gap: 10px;
            align-items: flex-start;
            flex-wrap: wrap;
        }
        
        .file-info {
            font-size: 12px;
            color: var(--vscode-descriptionForeground);
            flex: 1;
            min-width: 200px;
        }
        
        .search-box {
            display: flex;
            gap: 5px;
            flex: 1;
            min-width: 100%;
            flex-wrap: wrap;
            align-items: center;
        }
        
        input[type="text"] {
            flex: 1;
            min-width: 200px;
            padding: 5px 10px;
            background-color: var(--vscode-input-background);
            color: var(--vscode-input-foreground);
            border: 1px solid var(--vscode-input-border);
            border-radius: 3px;
            font-size: 12px;
        }
        
        button {
            padding: 5px 12px;
            background-color: var(--vscode-button-background);
            color: var(--vscode-button-foreground);
            border: none;
            border-radius: 3px;
            cursor: pointer;
            font-size: 12px;
            white-space: nowrap;
            transition: background-color 0.2s;
        }
        
        button:hover {
            background-color: var(--vscode-button-hoverBackground);
        }
        
        .log-container {
            flex: 1;
            overflow-y: auto;
            background-color: var(--vscode-editor-background);
            border: 1px solid var(--vscode-panel-border);
            border-radius: 5px;
            padding: 10px;
            font-family: 'Consolas', 'Courier New', monospace;
            font-size: 12px;
            line-height: 1.5;
        }
        
        .log-line {
            padding: 2px 0;
            border-bottom: 1px solid var(--vscode-panel-border);
            white-space: pre-wrap;
            word-break: break-all;
        }
        
        .log-line:hover {
            background-color: var(--vscode-list-hoverBackground);
        }
        
        .log-line-number {
            display: inline-block;
            width: 60px;
            color: var(--vscode-editorLineNumber-foreground);
            user-select: none;
            text-align: right;
            padding-right: 10px;
        }
        
        .log-line-content {
            display: inline;
        }
        
        .highlight {
            background-color: var(--vscode-editor-findMatchHighlightBackground);
            color: var(--vscode-editor-findMatchHighlightForeground);
        }
        
        .loading {
            text-align: center;
            padding: 20px;
            color: var(--vscode-descriptionForeground);
        }
        
        .stats {
            font-size: 11px;
            color: var(--vscode-descriptionForeground);
        }
        
        .filter-panel {
            background-color: var(--vscode-editorWidget-background);
            padding: 8px;
            border-radius: 5px;
            margin-bottom: 10px;
            display: flex;
            gap: 10px;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .checkbox-group {
            display: flex;
            gap: 15px;
            align-items: center;
        }
        
        .checkbox-group label {
            display: flex;
            align-items: center;
            gap: 5px;
            cursor: pointer;
            font-size: 12px;
        }
        
        .checkbox-group input[type="checkbox"] {
            cursor: pointer;
        }
        
        .log-line.error {
            border-left: 3px solid #f14c4c;
            padding-left: 5px;
        }
        
        .log-line.warn {
            border-left: 3px solid #cca700;
            padding-left: 5px;
        }
        
        .log-line.info {
            border-left: 3px solid #4fc1ff;
            padding-left: 5px;
        }
        
        .log-line.debug {
            border-left: 3px solid #b267e6;
            padding-left: 5px;
        }
        
        .log-line.highlight-target {
            background-color: rgba(255, 193, 7, 0.3);
            border-left: 3px solid #ffc107;
            animation: highlight-pulse 0.5s ease-in-out;
        }
        
        @keyframes highlight-pulse {
            0%, 100% { background-color: rgba(255, 193, 7, 0.3); }
            50% { background-color: rgba(255, 193, 7, 0.6); }
        }
        
        @keyframes fadeInOut {
            0% { opacity: 0; transform: translateY(-10px); }
            10% { opacity: 1; transform: translateY(0); }
            90% { opacity: 1; transform: translateY(0); }
            100% { opacity: 0; transform: translateY(-10px); }
        }
        
        /* å³é”®èœå•æ ·å¼ */
        .context-menu {
            position: fixed;
            background-color: var(--vscode-menu-background);
            border: 1px solid var(--vscode-menu-border);
            border-radius: 3px;
            padding: 4px 0;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
            z-index: 10000;
            min-width: 180px;
        }
        
        .context-menu-item {
            padding: 6px 16px;
            cursor: pointer;
            font-size: 13px;
            color: var(--vscode-menu-foreground);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .context-menu-item:hover {
            background-color: var(--vscode-menu-selectionBackground);
            color: var(--vscode-menu-selectionForeground);
        }
        
        .context-menu-separator {
            height: 1px;
            background-color: var(--vscode-menu-separatorBackground);
            margin: 4px 0;
        }
        
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
        }
        
        .modal-content {
            background-color: var(--vscode-editor-background);
            margin: 5% auto;
            border: 1px solid var(--vscode-panel-border);
            border-radius: 5px;
            width: 80%;
            max-width: 900px;
            max-height: 85vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        
        .modal-header {
            padding: 15px 20px;
            border-bottom: 1px solid var(--vscode-panel-border);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-shrink: 0;
        }
        
        .modal-header h2 {
            margin: 0;
            font-size: 18px;
        }
        
        .modal-body {
            padding: 20px;
            overflow-y: auto;
            overflow-x: hidden;
            flex: 1;
        }
        
        .modal-close {
            color: var(--vscode-foreground);
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-top: 15px;
        }
        
        .stats-card {
            background-color: var(--vscode-editorWidget-background);
            padding: 15px;
            border-radius: 5px;
            border: 1px solid var(--vscode-panel-border);
        }
        
        .stats-card h3 {
            font-size: 14px;
            margin-bottom: 5px;
            color: var(--vscode-descriptionForeground);
        }
        
        .stats-card .value {
            font-size: 24px;
            font-weight: bold;
            color: var(--vscode-foreground);
        }
        
        /* åˆ†é¡µæ ·å¼ */
        .pagination {
            background-color: var(--vscode-editorWidget-background);
            padding: 10px;
            border-radius: 5px;
            margin-top: 10px;
            display: flex;
            gap: 10px;
            align-items: center;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .pagination button {
            min-width: 35px;
            padding: 5px 10px;
        }
        
        .pagination button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .pagination .page-info {
            font-size: 13px;
            color: var(--vscode-descriptionForeground);
            margin: 0 10px;
            font-weight: 500;
        }
        
        .pagination input[type="number"] {
            width: 60px;
            padding: 3px 5px;
            text-align: center;
        }
        
        .pagination select {
            padding: 6px 8px;
            background-color: var(--vscode-input-background);
            color: var(--vscode-input-foreground);
            border: 1px solid var(--vscode-input-border);
            border-radius: 3px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 600;
        }
        
        .pagination select option {
            background-color: var(--vscode-dropdown-background);
            color: var(--vscode-dropdown-foreground);
            padding: 5px;
        }
        
        /* å¢å¼ºé«˜äº®æ ·å¼ */
        .highlight {
            background-color: #fbbf24;
            color: #000;
            padding: 2px 4px;
            border-radius: 2px;
            font-weight: bold;
        }
        
        .highlight-error {
            background-color: #f14c4c;
            color: #fff;
            padding: 2px 4px;
            border-radius: 2px;
            font-weight: bold;
        }
        
        .highlight-warn {
            background-color: #cca700;
            color: #fff;
            padding: 2px 4px;
            border-radius: 2px;
            font-weight: bold;
        }
        
        .highlight-info {
            background-color: #4fc1ff;
            color: #000;
            padding: 2px 4px;
            border-radius: 2px;
            font-weight: bold;
        }
        
        .highlight-time {
            background-color: #b267e6;
            color: #fff;
            padding: 2px 4px;
            border-radius: 2px;
            font-weight: bold;
        }
        
        /* é€šç”¨ select å’Œ option æ ·å¼ */
        select {
            background-color: var(--vscode-dropdown-background);
            color: var(--vscode-dropdown-foreground);
            border: 1px solid var(--vscode-dropdown-border);
            border-radius: 3px;
            cursor: pointer;
        }
        
        select option {
            background-color: var(--vscode-dropdown-background);
            color: var(--vscode-dropdown-foreground);
            padding: 5px;
        }
    </style>
</head>
<body>
    <div class="toolbar">
        <div class="file-info">
            <div><strong>æ–‡ä»¶:</strong> <span id="fileName">æœªåŠ è½½</span></div>
            <div class="stats">
                <span><strong>å¤§å°:</strong> <span id="fileSize">0</span>MB</span>
                <span style="margin-left: 15px;"><strong>æ€»è¡Œæ•°:</strong> <span id="totalLines">0</span></span>
                <span style="margin-left: 15px;"><strong>å·²åŠ è½½:</strong> <span id="loadedLines">0</span></span>
            </div>
        </div>
        <div class="search-box">
            <input type="text" id="searchInput" placeholder="æœç´¢æ—¥å¿—å†…å®¹...">
            <label style="font-size: 12px; display: flex; align-items: center; gap: 5px;">
                <input type="checkbox" id="regexMode">
                <span>æ­£åˆ™</span>
            </label>
            <button onclick="search()">ğŸ” æœç´¢</button>
            <button onclick="showAdvancedSearchModal()" style="background-color: #0e7490;">ğŸ” é«˜çº§æœç´¢</button>
            <button onclick="showJumpDialog()" style="background-color: #0e7490;">ğŸ¯ å®šä½</button>
            <button onclick="showBookmarksModal()" style="background-color: #7c3aed;">ğŸ“Œ ä¹¦ç­¾</button>
            <button onclick="showStats()">ğŸ“ˆ ç»Ÿè®¡</button>
            <button onclick="exportLogs()">ğŸ’¾ å¯¼å‡º</button>
            <button onclick="showDeleteModal()" style="background-color: #dc2626;">ğŸ—‘ï¸ åˆ é™¤</button>
            <button onclick="refresh()">ğŸ”„ åˆ·æ–°</button>
        </div>
    </div>
    
    <div class="filter-panel">
        <span style="font-size: 12px; font-weight: bold;">æ—¥å¿—çº§åˆ«:</span>
        <div class="checkbox-group">
            <label style="font-weight: bold; color: var(--vscode-button-background);">
                <input type="checkbox" id="filterAll" checked onchange="toggleAll()">
                <span>âœ”ï¸ å…¨é€‰</span>
            </label>
            <span style="width: 1px; height: 20px; background-color: var(--vscode-panel-border); margin: 0 5px;"></span>
            <label>
                <input type="checkbox" id="filterError" checked onchange="applyFilter()">
                <span style="color: #f14c4c; font-weight: bold;">â– </span> ERROR
            </label>
            <label>
                <input type="checkbox" id="filterWarn" checked onchange="applyFilter()">
                <span style="color: #cca700; font-weight: bold;">â– </span> WARN
            </label>
            <label>
                <input type="checkbox" id="filterInfo" checked onchange="applyFilter()">
                <span style="color: #4fc1ff; font-weight: bold;">â– </span> INFO
            </label>
            <label>
                <input type="checkbox" id="filterDebug" checked onchange="applyFilter()">
                <span style="color: #b267e6; font-weight: bold;">â– </span> DEBUG
            </label>
            <label><input type="checkbox" id="filterOther" checked onchange="applyFilter()"> å…¶ä»–</label>
        </div>
        <button onclick="showLegendModal()" style="margin-left: auto; padding: 3px 10px; font-size: 12px;">ğŸ¨ é¢œè‰²å›¾ä¾‹</button>
    </div>
    
    <div class="log-container" id="logContainer">
        <div class="loading">ç­‰å¾…åŠ è½½æ—¥å¿—æ–‡ä»¶...</div>
    </div>
    
    <!-- åˆ†é¡µæ§ä»¶ -->
    <div class="pagination" id="pagination" style="display: none;">
        <button onclick="goToFirstPage()" id="firstPageBtn">â®ï¸ é¦–é¡µ</button>
        <button onclick="goToPrevPage()" id="prevPageBtn">â—€ï¸ ä¸Šä¸€é¡µ</button>
        <span class="page-info">
            ç¬¬ <input type="number" id="currentPageInput" min="1" value="1" onchange="goToPage(this.value)"> 
            / <span id="totalPages">1</span> é¡µ
        </span>
        <button onclick="goToNextPage()" id="nextPageBtn">ä¸‹ä¸€é¡µ â–¶ï¸</button>
        <button onclick="goToLastPage()" id="lastPageBtn">æœ«é¡µ â­ï¸</button>
        <span class="page-info" style="margin-left: 20px;">
            <span style="font-size: 14px; font-weight: 600;">æ¯é¡µæ˜¾ç¤ºï¼š</span>
            <select id="pageSizeSelect" onchange="changePageSize(this.value)">
                <option value="50">50</option>
                <option value="100" selected>100</option>
                <option value="200">200</option>
                <option value="500">500</option>
                <option value="1000">1000</option>
            </select>
            <span style="font-size: 14px; font-weight: 600;">è¡Œ</span>
        </span>
        <span class="page-info">
            å…± <span id="totalLinesInPage">0</span> è¡Œ
        </span>
    </div>
    
    <!-- ç»Ÿè®¡å¼¹çª— -->
    <div id="statsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>æ—¥å¿—ç»Ÿè®¡ä¿¡æ¯</h2>
                <span class="modal-close" onclick="closeStatsModal()">&times;</span>
            </div>
            <div class="modal-body">
                <div class="stats-grid" id="statsGrid">
                    <!-- ç»Ÿè®¡ä¿¡æ¯å°†åŠ¨æ€ç”Ÿæˆ -->
                </div>
            </div>
        </div>
    </div>
    
    <!-- æŒ‰æ—¶é—´åˆ é™¤å¼¹çª— -->
    <div id="deleteByTimeModal" class="modal">
        <div class="modal-content">
            <span class="modal-close" onclick="closeDeleteByTimeModal()">&times;</span>
            <h2>â° æŒ‰æ—¶é—´åˆ é™¤æ—¥å¿—</h2>
            <div style="margin-top: 20px;">
                <div style="margin-bottom: 15px;">
                    <label style="display: block; margin-bottom: 5px; font-weight: bold;">åˆ é™¤æ¨¡å¼ï¼š</label>
                    <select id="deleteTimeMode" style="width: 100%; padding: 8px; background-color: var(--vscode-input-background); color: var(--vscode-input-foreground); border: 1px solid var(--vscode-input-border); border-radius: 3px;">
                        <option value="before">åˆ é™¤æŒ‡å®šæ—¶é—´ä¹‹å‰çš„æ—¥å¿—</option>
                        <option value="after">åˆ é™¤æŒ‡å®šæ—¶é—´ä¹‹åçš„æ—¥å¿—</option>
                    </select>
                </div>
                <div style="margin-bottom: 15px;">
                    <label style="display: block; margin-bottom: 5px; font-weight: bold;">æ—¶é—´ï¼ˆæ”¯æŒæ ¼å¼ï¼š2024-01-01 12:00:00 æˆ– 2024-01-01ï¼‰ï¼š</label>
                    <input type="text" id="deleteTimeInput" placeholder="ä¾‹å¦‚ï¼š2024-01-01 12:00:00" style="width: 100%; padding: 8px; background-color: var(--vscode-input-background); color: var(--vscode-input-foreground); border: 1px solid var(--vscode-input-border); border-radius: 3px;">
                </div>
                <div style="background-color: var(--vscode-editorWidget-background); padding: 10px; border-radius: 3px; margin-bottom: 15px; border-left: 3px solid #d97706;">
                    <strong>âš ï¸ è­¦å‘Šï¼š</strong>æ­¤æ“ä½œä¼šç›´æ¥ä¿®æ”¹åŸæ–‡ä»¶ï¼Œä¸å¯æ¢å¤ï¼è¯·åŠ¡å¿…å¤‡ä»½é‡è¦æ—¥å¿—ï¼
                </div>
                <div style="display: flex; gap: 10px; justify-content: flex-end;">
                    <button onclick="closeDeleteByTimeModal()">å–æ¶ˆ</button>
                    <button onclick="confirmDeleteByTime()" style="background-color: #d97706;">ç¡®è®¤åˆ é™¤</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- åˆ é™¤æ–¹å¼é€‰æ‹©å¼¹çª— -->
    <div id="deleteModal" class="modal">
        <div class="modal-content" style="max-width: 400px;">
            <div class="modal-header">
                <h2>ğŸ—‘ï¸ åˆ é™¤æ—¥å¿—</h2>
                <span class="modal-close" onclick="closeDeleteModal()">&times;</span>
            </div>
            <div class="modal-body">
                <div style="display: grid; gap: 15px;">
                    <button onclick="selectDeleteByTime()" style="padding: 15px; background-color: #d97706; display: flex; align-items: center; gap: 10px; font-size: 14px;">
                        <span style="font-size: 20px;">â°</span>
                        <div style="text-align: left;">
                            <div style="font-weight: bold;">æŒ‰æ—¶é—´åˆ é™¤</div>
                            <div style="font-size: 11px; opacity: 0.9; margin-top: 3px;">åˆ é™¤æŒ‡å®šæ—¶é—´ä¹‹å‰/ä¹‹åçš„æ—¥å¿—</div>
                        </div>
                    </button>
                    <button onclick="selectDeleteByLine()" style="padding: 15px; background-color: #dc2626; display: flex; align-items: center; gap: 10px; font-size: 14px;">
                        <span style="font-size: 20px;">ğŸ“Š</span>
                        <div style="text-align: left;">
                            <div style="font-weight: bold;">æŒ‰è¡Œæ•°åˆ é™¤</div>
                            <div style="font-size: 11px; opacity: 0.9; margin-top: 3px;">åˆ é™¤æŒ‡å®šè¡Œä¹‹å‰/ä¹‹åçš„æ—¥å¿—</div>
                        </div>
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- æŒ‰è¡Œæ•°åˆ é™¤å¼¹çª— -->
    <div id="deleteByLineModal" class="modal">
        <div class="modal-content">
            <span class="modal-close" onclick="closeDeleteByLineModal()">&times;</span>
            <h2>ğŸ“Š æŒ‰è¡Œæ•°åˆ é™¤æ—¥å¿—</h2>
            <div style="margin-top: 20px;">
                <div style="margin-bottom: 15px;">
                    <label style="display: block; margin-bottom: 5px; font-weight: bold;">åˆ é™¤æ¨¡å¼ï¼š</label>
                    <select id="deleteLineMode" style="width: 100%; padding: 8px; background-color: var(--vscode-input-background); color: var(--vscode-input-foreground); border: 1px solid var(--vscode-input-border); border-radius: 3px;">
                        <option value="before">åˆ é™¤æŒ‡å®šè¡Œä¹‹å‰çš„æ—¥å¿—</option>
                        <option value="after">åˆ é™¤æŒ‡å®šè¡Œä¹‹åçš„æ—¥å¿—</option>
                    </select>
                </div>
                <div style="margin-bottom: 15px;">
                    <label style="display: block; margin-bottom: 5px; font-weight: bold;">è¡Œå·ï¼ˆä»1å¼€å§‹ï¼‰ï¼š</label>
                    <input type="number" id="deleteLineInput" placeholder="ä¾‹å¦‚ï¼š1000" min="1" style="width: 100%; padding: 8px; background-color: var(--vscode-input-background); color: var(--vscode-input-foreground); border: 1px solid var(--vscode-input-border); border-radius: 3px;">
                </div>
                <div style="background-color: var(--vscode-editorWidget-background); padding: 10px; border-radius: 3px; margin-bottom: 15px; border-left: 3px solid #dc2626;">
                    <strong>âš ï¸ è­¦å‘Šï¼š</strong>æ­¤æ“ä½œä¼šç›´æ¥ä¿®æ”¹åŸæ–‡ä»¶ï¼Œä¸å¯æ¢å¤ï¼è¯·åŠ¡å¿…å¤‡ä»½é‡è¦æ—¥å¿—ï¼
                </div>
                <div style="display: flex; gap: 10px; justify-content: flex-end;">
                    <button onclick="closeDeleteByLineModal()">å–æ¶ˆ</button>
                    <button onclick="confirmDeleteByLine()" style="background-color: #dc2626;">ç¡®è®¤åˆ é™¤</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- å¿«é€Ÿå®šä½å¼¹çª— -->
    <div id="jumpModal" class="modal">
        <div class="modal-content" style="max-width: 500px;">
            <div class="modal-header">
                <h2>ğŸ¯ å¿«é€Ÿå®šä½</h2>
                <span class="modal-close" onclick="closeJumpModal()">&times;</span>
            </div>
            <div class="modal-body">
                <div style="margin-bottom: 20px;">
                    <label style="display: block; margin-bottom: 5px; font-weight: bold;">å®šä½æ–¹å¼ï¼š</label>
                    <select id="jumpMode" onchange="switchJumpMode()" style="width: 100%; padding: 8px; background-color: var(--vscode-input-background); color: var(--vscode-input-foreground); border: 1px solid var(--vscode-input-border); border-radius: 3px; font-size: 13px;">
                        <option value="line">ğŸ“ æŒ‰è¡Œå·å®šä½</option>
                        <option value="time">â° æŒ‰æ—¶é—´å®šä½</option>
                    </select>
                </div>
                <div id="jumpByLineSection">
                    <div style="margin-bottom: 15px;">
                        <label style="display: block; margin-bottom: 5px; font-weight: bold;">è¡Œå·ï¼ˆä»1å¼€å§‹ï¼‰ï¼š</label>
                        <input type="number" id="jumpLineInput" placeholder="ä¾‹å¦‚ï¼š1000" min="1" style="width: 100%; padding: 8px; background-color: var(--vscode-input-background); color: var(--vscode-input-foreground); border: 1px solid var(--vscode-input-border); border-radius: 3px;">
                    </div>
                </div>
                <div id="jumpByTimeSection" style="display: none;">
                    <div style="margin-bottom: 15px;">
                        <label style="display: block; margin-bottom: 5px; font-weight: bold;">æ—¶é—´ï¼ˆæ”¯æŒæ ¼å¼ï¼š2024-01-01 12:00:00 æˆ– 2024-01-01ï¼‰ï¼š</label>
                        <input type="text" id="jumpTimeInput" placeholder="ä¾‹å¦‚ï¼š2025-11-14 09:00:00" style="width: 100%; padding: 8px; background-color: var(--vscode-input-background); color: var(--vscode-input-foreground); border: 1px solid var(--vscode-input-border); border-radius: 3px;">
                    </div>
                </div>
                <div style="background-color: var(--vscode-editorWidget-background); padding: 10px; border-radius: 3px; margin-bottom: 15px; border-left: 3px solid #0e7490;">
                    <strong>ğŸ’¡ æç¤ºï¼š</strong>å®šä½åå°†è‡ªåŠ¨è·³è½¬åˆ°å¯¹åº”çš„é¡µé¢å¹¶é«˜äº®æ˜¾ç¤º
                </div>
                <div style="display: flex; gap: 10px; justify-content: flex-end;">
                    <button onclick="closeJumpModal()">å–æ¶ˆ</button>
                    <button onclick="confirmJump()" style="background-color: #0e7490;">å®šä½</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- é¢œè‰²å›¾ä¾‹å¼¹çª— -->
    <div id="legendModal" class="modal">
        <div class="modal-content" style="max-width: 600px;">
            <div class="modal-header">
                <h2>ğŸ¨ æ—¥å¿—çº§åˆ«é¢œè‰²å›¾ä¾‹</h2>
                <span class="modal-close" onclick="closeLegendModal()">&times;</span>
            </div>
            <div class="modal-body">
                <div style="display: grid; gap: 15px;">
                    <div style="display: flex; align-items: center; gap: 15px; padding: 10px; background-color: var(--vscode-editorWidget-background); border-radius: 5px; border-left: 3px solid #f14c4c;">
                        <span style="font-size: 24px; color: #f14c4c; font-weight: bold;">â– </span>
                        <div>
                            <div style="font-weight: bold; font-size: 14px;">ERROR / FATAL / SEVERE</div>
                            <div style="font-size: 12px; color: var(--vscode-descriptionForeground); margin-top: 3px;">é”™è¯¯çº§åˆ«ï¼Œè¡¨ç¤ºç³»ç»Ÿå‡ºç°ä¸¥é‡é—®é¢˜</div>
                        </div>
                    </div>
                    <div style="display: flex; align-items: center; gap: 15px; padding: 10px; background-color: var(--vscode-editorWidget-background); border-radius: 5px; border-left: 3px solid #cca700;">
                        <span style="font-size: 24px; color: #cca700; font-weight: bold;">â– </span>
                        <div>
                            <div style="font-weight: bold; font-size: 14px;">WARN / WARNING</div>
                            <div style="font-size: 12px; color: var(--vscode-descriptionForeground); margin-top: 3px;">è­¦å‘Šçº§åˆ«ï¼Œè¡¨ç¤ºæ½œåœ¨é—®é¢˜æˆ–éœ€è¦å…³æ³¨çš„æƒ…å†µ</div>
                        </div>
                    </div>
                    <div style="display: flex; align-items: center; gap: 15px; padding: 10px; background-color: var(--vscode-editorWidget-background); border-radius: 5px; border-left: 3px solid #4fc1ff;">
                        <span style="font-size: 24px; color: #4fc1ff; font-weight: bold;">â– </span>
                        <div>
                            <div style="font-weight: bold; font-size: 14px;">INFO / INFORMATION</div>
                            <div style="font-size: 12px; color: var(--vscode-descriptionForeground); margin-top: 3px;">ä¿¡æ¯çº§åˆ«ï¼Œè®°å½•æ­£å¸¸çš„ä¸šåŠ¡æµç¨‹å’ŒçŠ¶æ€</div>
                        </div>
                    </div>
                    <div style="display: flex; align-items: center; gap: 15px; padding: 10px; background-color: var(--vscode-editorWidget-background); border-radius: 5px; border-left: 3px solid #b267e6;">
                        <span style="font-size: 24px; color: #b267e6; font-weight: bold;">â– </span>
                        <div>
                            <div style="font-weight: bold; font-size: 14px;">DEBUG / TRACE / VERBOSE</div>
                            <div style="font-size: 12px; color: var(--vscode-descriptionForeground); margin-top: 3px;">è°ƒè¯•çº§åˆ«ï¼Œç”¨äºè¯¦ç»†çš„è°ƒè¯•ä¿¡æ¯</div>
                        </div>
                    </div>
                    <div style="display: flex; align-items: center; gap: 15px; padding: 10px; background-color: var(--vscode-editorWidget-background); border-radius: 5px; border-left: 3px solid var(--vscode-panel-border);">
                        <span style="font-size: 24px; color: var(--vscode-descriptionForeground); font-weight: bold;">â– </span>
                        <div>
                            <div style="font-weight: bold; font-size: 14px;">å…¶ä»–</div>
                            <div style="font-size: 12px; color: var(--vscode-descriptionForeground); margin-top: 3px;">æ— æ³•è¯†åˆ«çº§åˆ«çš„æ—¥å¿—è¡Œ</div>
                        </div>
                    </div>
                </div>
                <div style="margin-top: 20px; padding: 10px; background-color: var(--vscode-editorWidget-background); border-radius: 5px; border-left: 3px solid #ffc107;">
                    <div style="font-weight: bold; margin-bottom: 5px;">ğŸ’¡ å¿«æ·é”®æç¤ºï¼š</div>
                    <div style="font-size: 12px; color: var(--vscode-descriptionForeground); line-height: 1.6;">
                        â€¢ å³é”®ç‚¹å‡»æ—¥å¿—è¡Œå¯å¤åˆ¶å†…å®¹/æ·»åŠ ä¹¦ç­¾<br>
                        â€¢ åŒå‡»æ—¥å¿—è¡Œå¯å¿«é€Ÿæ·»åŠ ä¹¦ç­¾<br>
                        â€¢ é€‰ä¸­æ–‡æœ¬åå³é”®å¯å¤åˆ¶é€‰ä¸­éƒ¨åˆ†<br>
                        â€¢ ä½¿ç”¨è¿‡æ»¤é¢æ¿å¿«é€Ÿç­›é€‰æ—¥å¿—çº§åˆ«
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- ä¹¦ç­¾ç®¡ç†å¼¹çª— -->
    <div id="bookmarksModal" class="modal">
        <div class="modal-content" style="max-width: 700px;">
            <div class="modal-header">
                <h2>ğŸ“Œ ä¹¦ç­¾åˆ—è¡¨</h2>
                <span class="modal-close" onclick="closeBookmarksModal()">&times;</span>
            </div>
            <div class="modal-body">
                <div id="bookmarksList" style="max-height: 400px; overflow-y: auto;">
                    <!-- ä¹¦ç­¾å°†åŠ¨æ€ç”Ÿæˆ -->
                </div>
                <div style="margin-top: 15px; text-align: center; color: var(--vscode-descriptionForeground); font-size: 12px;">
                    ğŸ’¡ æç¤ºï¼šåŒå‡»æ—¥å¿—è¡Œå¯æ·»åŠ /ç§»é™¤ä¹¦ç­¾
                </div>
            </div>
        </div>
    </div>
    
    <!-- é«˜çº§æœç´¢å¼¹çª— -->
    <div id="advancedSearchModal" class="modal">
        <div class="modal-content" style="max-width: 600px;">
            <div class="modal-header">
                <h2>ğŸ” é«˜çº§æœç´¢</h2>
                <span class="modal-close" onclick="closeAdvancedSearchModal()">&times;</span>
            </div>
            <div class="modal-body">
                <div style="margin-bottom: 15px;">
                    <label style="display: block; margin-bottom: 5px; font-weight: bold;">å…³é”®è¯ï¼š</label>
                    <input type="text" id="advSearchKeyword" placeholder="è¾“å…¥æœç´¢å…³é”®è¯" style="width: 100%; padding: 8px; background-color: var(--vscode-input-background); color: var(--vscode-input-foreground); border: 1px solid var(--vscode-input-border); border-radius: 3px;">
                </div>
                <div style="margin-bottom: 15px;">
                    <label style="display: block; margin-bottom: 5px; font-weight: bold;">æ—¶é—´èŒƒå›´ï¼š</label>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                        <input type="text" id="advSearchStartTime" placeholder="å¼€å§‹æ—¶é—´ (2024-01-01 10:00:00)" style="padding: 8px; background-color: var(--vscode-input-background); color: var(--vscode-input-foreground); border: 1px solid var(--vscode-input-border); border-radius: 3px;">
                        <input type="text" id="advSearchEndTime" placeholder="ç»“æŸæ—¶é—´ (2024-01-01 18:00:00)" style="padding: 8px; background-color: var(--vscode-input-background); color: var(--vscode-input-foreground); border: 1px solid var(--vscode-input-border); border-radius: 3px;">
                    </div>
                </div>
                <div style="margin-bottom: 15px;">
                    <label style="display: block; margin-bottom: 5px; font-weight: bold;">æ—¥å¿—çº§åˆ«ï¼š</label>
                    <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                        <label><input type="checkbox" id="advSearchError" checked> <span style="color: #f14c4c;">â– </span> ERROR</label>
                        <label><input type="checkbox" id="advSearchWarn" checked> <span style="color: #cca700;">â– </span> WARN</label>
                        <label><input type="checkbox" id="advSearchInfo" checked> <span style="color: #4fc1ff;">â– </span> INFO</label>
                        <label><input type="checkbox" id="advSearchDebug" checked> <span style="color: #b267e6;">â– </span> DEBUG</label>
                        <label><input type="checkbox" id="advSearchOther" checked> å…¶ä»–</label>
                    </div>
                </div>
                <div style="background-color: var(--vscode-editorWidget-background); padding: 10px; border-radius: 3px; margin-bottom: 15px; border-left: 3px solid #0e7490;">
                    <strong>ğŸ’¡ æç¤ºï¼š</strong>å¯ä»¥å•ç‹¬ä½¿ç”¨å…³é”®è¯ã€æ—¶é—´èŒƒå›´æˆ–çº§åˆ«ï¼Œä¹Ÿå¯ä»¥ç»„åˆä½¿ç”¨
                </div>
                <div style="display: flex; gap: 10px; justify-content: flex-end;">
                    <button onclick="closeAdvancedSearchModal()">å–æ¶ˆ</button>
                    <button onclick="confirmAdvancedSearch()" style="background-color: #0e7490;">æœç´¢</button>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        const vscode = acquireVsCodeApi();
        let allLines = [];
        let currentSearchKeyword = '';
        let originalLines = []; // ä¿å­˜åŸå§‹æ•°æ®ç”¨äºè¿‡æ»¤
        let isFiltering = false; // æ ‡è®°æ˜¯å¦åœ¨è¿‡æ»¤æ¨¡å¼ä¸‹
        let bookmarks = new Set(); // ä¹¦ç­¾é›†åˆï¼Œå­˜å‚¨è¡Œå·
        
        // åˆ†é¡µå‚æ•°
        let currentPage = 1;
        let pageSize = 100;
        let totalPages = 1;
        
        // æ•°æ®åŠ è½½çŠ¶æ€
        let totalLinesInFile = 0;
        let allDataLoaded = false;
        
        window.addEventListener('message', event => {
            const message = event.data;
            
            switch (message.command) {
                case 'fileLoaded':
                    handleFileLoaded(message.data);
                    break;
                case 'moreLines':
                    handleMoreLines(message.data);
                    break;
                case 'searchResults':
                    handleSearchResults(message.data);
                    break;
                case 'filterResults':
                    handleFilterResults(message.data);
                    break;
                case 'statisticsResults':
                    handleStatisticsResults(message.data);
                    break;
                case 'jumpToTimeResult':
                    handleJumpToTimeResult(message.data);
                    break;
            }
        });
        
        function handleFileLoaded(data) {
            document.getElementById('fileName').textContent = data.fileName;
            document.getElementById('fileSize').textContent = data.fileSize;
            document.getElementById('totalLines').textContent = data.totalLines;
            
            totalLinesInFile = data.totalLines;
            allDataLoaded = data.allLoaded || false;
            isFiltering = false; // é‡ç½®è¿‡æ»¤çŠ¶æ€
            
            allLines = data.lines;
            originalLines = [...data.lines];
            currentPage = 1;
            updatePagination();
            renderLines();
            
            // å¦‚æœæ•°æ®æœªå…¨éƒ¨åŠ è½½ï¼Œæ˜¾ç¤ºæç¤º
            if (!allDataLoaded && allLines.length < totalLinesInFile) {
                showLoadMoreHint();
            }
        }
        
        function handleMoreLines(data) {
            allLines = allLines.concat(data.lines);
            originalLines = originalLines.concat(data.lines);
            
            // æ£€æŸ¥æ˜¯å¦å·²åŠ è½½å…¨éƒ¨æ•°æ®
            if (allLines.length >= totalLinesInFile) {
                allDataLoaded = true;
            }
            
            updatePagination();
            renderLines();
        }
        
        function handleSearchResults(data) {
            currentSearchKeyword = data.keyword;
            allLines = data.results;
            currentPage = 1;
            updatePagination();
            renderLines();
        }
        
        function handleFilterResults(data) {
            console.log('ğŸ“¥ æ”¶åˆ°è¿‡æ»¤ç»“æœ:', data.results.length, 'æ¡');
            allLines = data.results;
            isFiltering = true; // è®¾ç½®ä¸ºè¿‡æ»¤æ¨¡å¼
            currentPage = 1;
            updatePagination();
            renderLines();
            
            // å¦‚æœè¿‡æ»¤ç»“æœä¸ºç©ºï¼Œç»™å‡ºå‹å¥½æç¤º
            if (data.results.length === 0) {
                const levelText = data.levels.join('ã€');
                vscode.postMessage({
                    command: 'showMessage',
                    type: 'warning',
                    message: `æœªæ‰¾åˆ° ${levelText} çº§åˆ«çš„æ—¥å¿—ï¼Œè¯·å°è¯•å…¶ä»–çº§åˆ«æˆ–æŸ¥çœ‹ç»Ÿè®¡ä¿¡æ¯`
                });
            }
        }
        
        function handleStatisticsResults(data) {
            showStatsModal(data);
        }
        
        function renderLines() {
            const container = document.getElementById('logContainer');
            container.innerHTML = '';
            
            console.log('ğŸ¨ æ¸²æŸ“æ—¥å¿— - å½“å‰ allLines æ•°é‡:', allLines.length);
            
            if (allLines.length === 0) {
                container.innerHTML = '<div class="loading">æ²¡æœ‰æ—¥å¿—æ•°æ®</div>';
                document.getElementById('pagination').style.display = 'none';
                document.getElementById('loadedLines').textContent = '0';
                console.log('âš ï¸ æ¸²æŸ“ç»“æœ: æ˜¾ç¤º"æ²¡æœ‰æ—¥å¿—æ•°æ®"');
                return;
            }
            
            // è®¡ç®—åˆ†é¡µ
            const startIndex = (currentPage - 1) * pageSize;
            const endIndex = Math.min(startIndex + pageSize, allLines.length);
            const pageLines = allLines.slice(startIndex, endIndex);
            
            pageLines.forEach((line, index) => {
                const lineDiv = document.createElement('div');
                lineDiv.className = 'log-line';
                
                const actualLineNumber = line.lineNumber || startIndex + index + 1;
                
                // æ ¹æ®æ—¥å¿—çº§åˆ«æ·»åŠ æ ·å¼
                if (line.level) {
                    lineDiv.classList.add(line.level.toLowerCase());
                }
                
                // å¦‚æœæ˜¯ä¹¦ç­¾è¡Œï¼Œæ·»åŠ ä¹¦ç­¾æ ‡è®°
                if (bookmarks.has(actualLineNumber)) {
                    lineDiv.style.backgroundColor = 'rgba(255, 193, 7, 0.1)';
                    lineDiv.style.borderRight = '3px solid #ffc107';
                }
                
                const lineNumber = document.createElement('span');
                lineNumber.className = 'log-line-number';
                lineNumber.textContent = actualLineNumber.toString();
                
                // å¦‚æœæ˜¯ä¹¦ç­¾ï¼Œæ˜¾ç¤ºä¹¦ç­¾å›¾æ ‡
                if (bookmarks.has(actualLineNumber)) {
                    lineNumber.textContent = 'ğŸ“Œ ' + lineNumber.textContent;
                }
                
                const lineContent = document.createElement('span');
                lineContent.className = 'log-line-content';
                
                const content = line.content || line;
                
                // å¢å¼ºé«˜äº®åŠŸèƒ½
                let highlightedContent = highlightKeywords(content, currentSearchKeyword);
                lineContent.innerHTML = highlightedContent;
                
                // æ·»åŠ å³é”®èœå•å¤åˆ¶åŠŸèƒ½
                lineDiv.oncontextmenu = (e) => {
                    e.preventDefault();
                    showContextMenu(e, content, actualLineNumber);
                };
                
                // æ·»åŠ åŒå‡»ä¹¦ç­¾åŠŸèƒ½
                lineDiv.ondblclick = (e) => {
                    e.stopPropagation();
                    toggleBookmark(actualLineNumber);
                };
                
                lineDiv.appendChild(lineNumber);
                lineDiv.appendChild(lineContent);
                container.appendChild(lineDiv);
            });
            
            document.getElementById('loadedLines').textContent = allLines.length;
            document.getElementById('pagination').style.display = 'flex';
        }
        
        // å¢å¼ºçš„å…³é”®è¯é«˜äº®åŠŸèƒ½
        function highlightKeywords(content, keyword) {
            if (!content) return '';
            
            let result = escapeHtml(content);
            
            // é«˜äº®æ—¥å¿—çº§åˆ«
            result = result.replace(/\b(ERROR)\b/gi, '<span class="highlight-error">$1</span>');
            result = result.replace(/\b(WARN|WARNING)\b/gi, '<span class="highlight-warn">$1</span>');
            result = result.replace(/\b(INFO)\b/gi, '<span class="highlight-info">$1</span>');
            
            // é«˜äº®æ—¶é—´æˆ³
            result = result.replace(/(\d{4}[-/]\d{2}[-/]\d{2}[T\s]\d{2}:\d{2}:\d{2}(\.\d+)?)/g, '<span class="highlight-time">$1</span>');
            result = result.replace(/(\[\d{4}[-/]\d{2}[-/]\d{2}[T\s]\d{2}:\d{2}:\d{2}(\.\d+)?\])/g, '<span class="highlight-time">$1</span>');
            
            // é«˜äº®æœç´¢å…³é”®è¯
            if (keyword) {
                const regex = new RegExp('(' + escapeRegex(keyword) + ')', 'gi');
                result = result.replace(regex, '<span class="highlight">$1</span>');
            }
            
            return result;
        }
        
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
        
        function escapeRegex(str) {
            return str.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
        }
        
        function search() {
            const keyword = document.getElementById('searchInput').value;
            const isRegex = document.getElementById('regexMode').checked;
            
            if (!keyword) {
                vscode.postMessage({
                    command: 'refresh'
                });
                currentSearchKeyword = '';
                return;
            }
            
            if (isRegex) {
                vscode.postMessage({
                    command: 'regexSearch',
                    pattern: keyword,
                    flags: 'gi'
                });
            } else {
                vscode.postMessage({
                    command: 'search',
                    keyword: keyword
                });
            }
        }
        
        function applyFilter() {
            const levels = [];
            const errorChecked = document.getElementById('filterError').checked;
            const warnChecked = document.getElementById('filterWarn').checked;
            const infoChecked = document.getElementById('filterInfo').checked;
            const debugChecked = document.getElementById('filterDebug').checked;
            const otherChecked = document.getElementById('filterOther').checked;
            
            if (errorChecked) { levels.push('ERROR'); }
            if (warnChecked) { levels.push('WARN'); }
            if (infoChecked) { levels.push('INFO'); }
            if (debugChecked) { levels.push('DEBUG'); }
            
            console.log('Filter applied:', levels);
            console.log('Checkboxes:', { errorChecked, warnChecked, infoChecked, debugChecked, otherChecked });
            
            // æ›´æ–°å…¨é€‰æ¡†çŠ¶æ€
            const allChecked = errorChecked && warnChecked && infoChecked && debugChecked && otherChecked;
            const allUnchecked = !errorChecked && !warnChecked && !infoChecked && !debugChecked && !otherChecked;
            const filterAllCheckbox = document.getElementById('filterAll');
            
            console.log('ğŸ”µ æ£€æŸ¥å…¨é€‰çŠ¶æ€ - allChecked:', allChecked, 'allUnchecked:', allUnchecked);
            
            if (allChecked) {
                filterAllCheckbox.checked = true;
                filterAllCheckbox.indeterminate = false;
            } else if (allUnchecked) {
                filterAllCheckbox.checked = false;
                filterAllCheckbox.indeterminate = false;
            } else {
                filterAllCheckbox.indeterminate = true;
            }
            
            // å¦‚æœå…¨éƒ¨é€‰ä¸­ï¼Œåˆ·æ–°æ˜¾ç¤ºæ‰€æœ‰æ•°æ®
            if (allChecked) {
                console.log('âš ï¸ å…¨éƒ¨é€‰ä¸­ï¼Œåˆ·æ–°...');
                if (!currentSearchKeyword) {
                    vscode.postMessage({ command: 'refresh' });
                }
                return;
            }
            
            // å¦‚æœå…¨éƒ¨ä¸é€‰ï¼Œæ˜¾ç¤ºç©º
            if (levels.length === 0) {
                console.log('âš ï¸ æ²¡æœ‰é€‰æ‹©ä»»ä½•çº§åˆ«');
                allLines = [];
                renderLines();
                return;
            }
            
            // å‘é€ç­›é€‰è¯·æ±‚
            console.log('ğŸ“¤ å‘é€è¿‡æ»¤è¯·æ±‚:', levels);
            vscode.postMessage({
                command: 'filterByLevel',
                levels: levels
            });
        }
        
        function toggleAll() {
            const filterAll = document.getElementById('filterAll');
            const checked = filterAll.checked;
            
            document.getElementById('filterError').checked = checked;
            document.getElementById('filterWarn').checked = checked;
            document.getElementById('filterInfo').checked = checked;
            document.getElementById('filterDebug').checked = checked;
            document.getElementById('filterOther').checked = checked;
            
            filterAll.indeterminate = false;
            applyFilter();
        }
        
        function showStats() {
            vscode.postMessage({
                command: 'getStatistics'
            });
        }
        
        function showStatsModal(stats) {
            const grid = document.getElementById('statsGrid');
            
            // è½¬æ¢ Map ä¸ºæ•°ç»„å¹¶æ’åº
            const classStats = stats.classCounts ? 
                Array.from(Object.entries(stats.classCounts)).sort((a, b) => b[1] - a[1]).slice(0, 10) : [];
            const methodStats = stats.methodCounts ? 
                Array.from(Object.entries(stats.methodCounts)).sort((a, b) => b[1] - a[1]).slice(0, 10) : [];
            const threadStats = stats.threadCounts ? 
                Array.from(Object.entries(stats.threadCounts)).sort((a, b) => b[1] - a[1]).slice(0, 10) : [];
            
            grid.innerHTML = `
                <div class="stats-card">
                    <h3>æ€»è¡Œæ•°</h3>
                    <div class="value">${stats.totalLines}</div>
                </div>
                <div class="stats-card">
                    <h3>ERROR</h3>
                    <div class="value" style="color: #f14c4c;">${stats.errorCount}</div>
                </div>
                <div class="stats-card">
                    <h3>WARN</h3>
                    <div class="value" style="color: #cca700;">${stats.warnCount}</div>
                </div>
                <div class="stats-card">
                    <h3>INFO</h3>
                    <div class="value" style="color: #4fc1ff;">${stats.infoCount}</div>
                </div>
                <div class="stats-card">
                    <h3>DEBUG</h3>
                    <div class="value" style="color: #b267e6;">${stats.debugCount}</div>
                </div>
                <div class="stats-card">
                    <h3>å…¶ä»–</h3>
                    <div class="value">${stats.otherCount}</div>
                </div>
            `;
            
            if (stats.timeRange && stats.timeRange.start) {
                grid.innerHTML += `
                    <div class="stats-card" style="grid-column: 1 / -1;">
                        <h3>æ—¶é—´èŒƒå›´</h3>
                        <div style="font-size: 14px;">
                            ${new Date(stats.timeRange.start).toLocaleString()} - 
                            ${new Date(stats.timeRange.end).toLocaleString()}
                        </div>
                    </div>
                `;
            }
            
            // æ·»åŠ ç±»åç»Ÿè®¡
            if (classStats.length > 0) {
                grid.innerHTML += `
                    <div class="stats-card" style="grid-column: 1 / -1;">
                        <h3>ğŸ“Š æœ€æ´»è·ƒçš„ç±» (Top 10)</h3>
                        <div style="font-size: 13px; margin-top: 10px;">
                            ${classStats.map(([name, count]) => 
                                `<div style="padding: 5px 0; border-bottom: 1px solid var(--vscode-panel-border); cursor: pointer; transition: background-color 0.2s;" 
                                      onmouseover="this.style.backgroundColor='var(--vscode-list-hoverBackground)'" 
                                      onmouseout="this.style.backgroundColor='transparent'"
                                      onclick="filterByClassName('${name.replace(/'/g, "\\'")}')"
                                      title="ç‚¹å‡»ç­›é€‰åŒ…å«æ­¤ç±»çš„æ—¥å¿—">
                                    <span style="font-weight: bold; color: var(--vscode-textLink-foreground);">${name}</span>
                                    <span style="float: right; color: var(--vscode-descriptionForeground);">${count} æ¬¡</span>
                                </div>`
                            ).join('')}
                        </div>
                    </div>
                `;
            }
            
            // æ·»åŠ æ–¹æ³•åç»Ÿè®¡
            if (methodStats.length > 0) {
                grid.innerHTML += `
                    <div class="stats-card" style="grid-column: 1 / -1;">
                        <h3>ğŸ”§ æœ€å¸¸è°ƒç”¨çš„æ–¹æ³• (Top 10)</h3>
                        <div style="font-size: 13px; margin-top: 10px;">
                            ${methodStats.map(([name, count]) => 
                                `<div style="padding: 5px 0; border-bottom: 1px solid var(--vscode-panel-border); cursor: pointer; transition: background-color 0.2s;" 
                                      onmouseover="this.style.backgroundColor='var(--vscode-list-hoverBackground)'" 
                                      onmouseout="this.style.backgroundColor='transparent'"
                                      onclick="filterByMethodName('${name.replace(/'/g, "\\'")}')"
                                      title="ç‚¹å‡»ç­›é€‰åŒ…å«æ­¤æ–¹æ³•çš„æ—¥å¿—">
                                    <span style="font-weight: bold; color: var(--vscode-textLink-foreground);">${name}</span>
                                    <span style="float: right; color: var(--vscode-descriptionForeground);">${count} æ¬¡</span>
                                </div>`
                            ).join('')}
                        </div>
                    </div>
                `;
            }
            
            // æ·»åŠ çº¿ç¨‹åç»Ÿè®¡
            if (threadStats.length > 0) {
                grid.innerHTML += `
                    <div class="stats-card" style="grid-column: 1 / -1;">
                        <h3>ğŸ§µ æœ€æ´»è·ƒçš„çº¿ç¨‹ (Top 10)</h3>
                        <div style="font-size: 13px; margin-top: 10px;">
                            ${threadStats.map(([name, count]) => 
                                `<div style="padding: 5px 0; border-bottom: 1px solid var(--vscode-panel-border); cursor: pointer; transition: background-color 0.2s;" 
                                      onmouseover="this.style.backgroundColor='var(--vscode-list-hoverBackground)'" 
                                      onmouseout="this.style.backgroundColor='transparent'"
                                      onclick="filterByThreadName('${name.replace(/'/g, "\\'")}')"
                                      title="ç‚¹å‡»ç­›é€‰åŒ…å«æ­¤çº¿ç¨‹çš„æ—¥å¿—">
                                    <span style="font-weight: bold; color: var(--vscode-textLink-foreground);">${name}</span>
                                    <span style="float: right; color: var(--vscode-descriptionForeground);">${count} æ¬¡</span>
                                </div>`
                            ).join('')}
                        </div>
                    </div>
                `;
            }
            
            document.getElementById('statsModal').style.display = 'block';
        }
        
        function closeStatsModal() {
            document.getElementById('statsModal').style.display = 'none';
        }
        
        // ========== é¢œè‰²å›¾ä¾‹å¼¹çª— ==========
        function showLegendModal() {
            document.getElementById('legendModal').style.display = 'block';
        }
        
        function closeLegendModal() {
            document.getElementById('legendModal').style.display = 'none';
        }
        
        // ========== ä¹¦ç­¾åŠŸèƒ½ ==========
        function toggleBookmark(lineNumber) {
            if (bookmarks.has(lineNumber)) {
                bookmarks.delete(lineNumber);
                console.log('â– ç§»é™¤ä¹¦ç­¾:', lineNumber);
            } else {
                bookmarks.add(lineNumber);
                console.log('â• æ·»åŠ ä¹¦ç­¾:', lineNumber);
            }
            renderLines(); // é‡æ–°æ¸²æŸ“ä»¥æ˜¾ç¤ºä¹¦ç­¾æ ‡è®°
        }
        
        function showBookmarksModal() {
            const modal = document.getElementById('bookmarksModal');
            const list = document.getElementById('bookmarksList');
            
            if (bookmarks.size === 0) {
                list.innerHTML = '<div style="text-align: center; padding: 40px; color: var(--vscode-descriptionForeground);">æš‚æ— ä¹¦ç­¾<br>åŒå‡»æ—¥å¿—è¡Œå¯æ·»åŠ ä¹¦ç­¾</div>';
            } else {
                const bookmarkArray = Array.from(bookmarks).sort((a, b) => a - b);
                list.innerHTML = bookmarkArray.map(lineNum => {
                    const line = allLines.find(l => l.lineNumber === lineNum);
                    const content = line ? (line.content || line) : 'ï¼ˆå·²ä¸å­˜åœ¨ï¼‰';
                    const preview = content.substring(0, 100) + (content.length > 100 ? '...' : '');
                    
                    return `
                        <div style="padding: 10px; margin-bottom: 10px; background-color: var(--vscode-editorWidget-background); border-radius: 5px; border-left: 3px solid #ffc107; cursor: pointer; transition: background-color 0.2s;"
                             onmouseover="this.style.backgroundColor='var(--vscode-list-hoverBackground)'"
                             onmouseout="this.style.backgroundColor='var(--vscode-editorWidget-background)'"
                             onclick="jumpToBookmark(${lineNum})">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px;">
                                <span style="font-weight: bold; color: var(--vscode-textLink-foreground);">ğŸ“Œ è¡Œ ${lineNum}</span>
                                <button onclick="event.stopPropagation(); removeBookmark(${lineNum})" style="padding: 2px 8px; font-size: 11px; background-color: #dc2626;">åˆ é™¤</button>
                            </div>
                            <div style="font-size: 12px; color: var(--vscode-descriptionForeground); font-family: 'Consolas', monospace; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">
                                ${escapeHtml(preview)}
                            </div>
                        </div>
                    `;
                }).join('');
            }
            
            modal.style.display = 'block';
        }
        
        function closeBookmarksModal() {
            document.getElementById('bookmarksModal').style.display = 'none';
        }
        
        function jumpToBookmark(lineNumber) {
            closeBookmarksModal();
            jumpToLine(lineNumber);
        }
        
        function removeBookmark(lineNumber) {
            bookmarks.delete(lineNumber);
            showBookmarksModal(); // åˆ·æ–°ä¹¦ç­¾åˆ—è¡¨
            renderLines(); // é‡æ–°æ¸²æŸ“
        }
        
        // ========== å¤åˆ¶åŠŸèƒ½ ==========
        let currentContextMenu = null;
        
        function showContextMenu(event, content, lineNumber) {
            // ç§»é™¤æ—§çš„èœå•
            if (currentContextMenu) {
                document.body.removeChild(currentContextMenu);
            }
            
            // è·å–é€‰ä¸­çš„æ–‡æœ¬
            const selectedText = window.getSelection().toString();
            
            // åˆ›å»ºèœå•
            const menu = document.createElement('div');
            menu.className = 'context-menu';
            
            // å¤åˆ¶é€‰ä¸­æ–‡æœ¬
            if (selectedText) {
                const copySelectedItem = document.createElement('div');
                copySelectedItem.className = 'context-menu-item';
                copySelectedItem.innerHTML = '<span>ğŸ“‹</span><span>å¤åˆ¶é€‰ä¸­å†…å®¹</span>';
                copySelectedItem.onclick = () => {
                    copyToClipboard(selectedText);
                    closeContextMenu();
                };
                menu.appendChild(copySelectedItem);
                
                // åˆ†éš”çº¿
                const separator1 = document.createElement('div');
                separator1.className = 'context-menu-separator';
                menu.appendChild(separator1);
            }
            
            // å¤åˆ¶æ•´è¡Œ
            const copyLineItem = document.createElement('div');
            copyLineItem.className = 'context-menu-item';
            copyLineItem.innerHTML = '<span>ğŸ“„</span><span>å¤åˆ¶æ•´è¡Œ</span>';
            copyLineItem.onclick = () => {
                copyToClipboard(content);
                closeContextMenu();
            };
            menu.appendChild(copyLineItem);
            
            // åˆ†éš”çº¿
            const separator2 = document.createElement('div');
            separator2.className = 'context-menu-separator';
            menu.appendChild(separator2);
            
            // æ·»åŠ /ç§»é™¤ä¹¦ç­¾
            const bookmarkItem = document.createElement('div');
            bookmarkItem.className = 'context-menu-item';
            const isBookmarked = bookmarks.has(lineNumber);
            bookmarkItem.innerHTML = isBookmarked 
                ? '<span>âŒ</span><span>ç§»é™¤ä¹¦ç­¾</span>' 
                : '<span>ğŸ“Œ</span><span>æ·»åŠ ä¹¦ç­¾</span>';
            bookmarkItem.onclick = () => {
                toggleBookmark(lineNumber);
                closeContextMenu();
            };
            menu.appendChild(bookmarkItem);
            
            // å®šä½åˆ°æ­¤è¡Œ
            const jumpItem = document.createElement('div');
            jumpItem.className = 'context-menu-item';
            jumpItem.innerHTML = '<span>ğŸ¯</span><span>å®šä½åˆ°ç¬¬ ' + lineNumber + ' è¡Œ</span>';
            jumpItem.onclick = () => {
                jumpToLine(lineNumber);
                closeContextMenu();
            };
            menu.appendChild(jumpItem);
            
            // è®¾ç½®ä½ç½®
            menu.style.left = event.pageX + 'px';
            menu.style.top = event.pageY + 'px';
            
            document.body.appendChild(menu);
            currentContextMenu = menu;
            
            // ç‚¹å‡»å…¶ä»–åœ°æ–¹å…³é—­èœå•
            setTimeout(() => {
                document.addEventListener('click', closeContextMenu);
            }, 0);
        }
        
        function closeContextMenu() {
            if (currentContextMenu) {
                document.body.removeChild(currentContextMenu);
                currentContextMenu = null;
            }
            document.removeEventListener('click', closeContextMenu);
        }
        
        function copyToClipboard(text) {
            // ä½¿ç”¨ Clipboard API
            navigator.clipboard.writeText(text).then(() => {
                // æ˜¾ç¤ºå¤åˆ¶æˆåŠŸæç¤º
                showCopyToast();
            }).catch(err => {
                console.error('å¤åˆ¶å¤±è´¥:', err);
            });
        }
        
        function showCopyToast() {
            const toast = document.createElement('div');
            toast.textContent = 'âœ… å·²å¤åˆ¶åˆ°å‰ªè´´æ¿';
            toast.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background-color: #10b981;
                color: white;
                padding: 10px 20px;
                border-radius: 5px;
                font-weight: bold;
                z-index: 10000;
                animation: fadeInOut 2s ease-in-out;
            `;
            document.body.appendChild(toast);
            
            setTimeout(() => {
                document.body.removeChild(toast);
            }, 2000);
        }
        
        // ========== é«˜çº§æœç´¢ ==========
        function showAdvancedSearchModal() {
            document.getElementById('advancedSearchModal').style.display = 'block';
        }
        
        function closeAdvancedSearchModal() {
            document.getElementById('advancedSearchModal').style.display = 'none';
        }
        
        function confirmAdvancedSearch() {
            const keyword = document.getElementById('advSearchKeyword').value.trim();
            const startTime = document.getElementById('advSearchStartTime').value.trim();
            const endTime = document.getElementById('advSearchEndTime').value.trim();
            
            const levels = [];
            if (document.getElementById('advSearchError').checked) levels.push('ERROR');
            if (document.getElementById('advSearchWarn').checked) levels.push('WARN');
            if (document.getElementById('advSearchInfo').checked) levels.push('INFO');
            if (document.getElementById('advSearchDebug').checked) levels.push('DEBUG');
            if (document.getElementById('advSearchOther').checked) levels.push('OTHER');
            
            console.log('ğŸ” é«˜çº§æœç´¢:', { keyword, startTime, endTime, levels });
            
            // åœ¨å·²åŠ è½½çš„æ•°æ®ä¸­è¿›è¡Œè¿‡æ»¤
            let results = [...allLines];
            
            // è¿‡æ»¤å…³é”®è¯
            if (keyword) {
                results = results.filter(line => {
                    const content = line.content || line;
                    return content.includes(keyword);
                });
            }
            
            // è¿‡æ»¤æ—¶é—´èŒƒå›´
            if (startTime || endTime) {
                results = results.filter(line => {
                    if (!line.timestamp) return false;
                    const lineTime = new Date(line.timestamp);
                    
                    if (startTime) {
                        const start = new Date(startTime);
                        if (lineTime < start) return false;
                    }
                    
                    if (endTime) {
                        const end = new Date(endTime);
                        if (lineTime > end) return false;
                    }
                    
                    return true;
                });
            }
            
            // è¿‡æ»¤çº§åˆ«
            if (levels.length > 0 && levels.length < 5) {
                results = results.filter(line => {
                    const level = line.level ? line.level.toUpperCase() : 'OTHER';
                    return levels.includes(level);
                });
            }
            
            console.log('âœ… æœç´¢ç»“æœ:', results.length, 'æ¡');
            
            allLines = results;
            currentPage = 1;
            isFiltering = true;
            updatePagination();
            renderLines();
            
            closeAdvancedSearchModal();
            
            if (results.length === 0) {
                alert('æœªæ‰¾åˆ°ç¬¦åˆæ¡ä»¶çš„æ—¥å¿—ï¼');
            }
        }
        
        // æŒ‰ç±»åç­›é€‰
        function filterByClassName(className) {
            console.log('ğŸ” æŒ‰ç±»åç­›é€‰:', className);
            closeStatsModal();
            // ä½¿ç”¨æ­£åˆ™æœç´¢
            vscode.postMessage({
                command: 'regexSearch',
                pattern: className.replace(/\./g, '\\.'),  // è½¬ä¹‰ç‚¹å·
                flags: 'i'
            });
        }
        
        // æŒ‰æ–¹æ³•åç­›é€‰
        function filterByMethodName(methodName) {
            console.log('ğŸ”§ æŒ‰æ–¹æ³•åç­›é€‰:', methodName);
            closeStatsModal();
            // æœç´¢ <æ–¹æ³•å> æˆ– æ–¹æ³•åæ¥å£
            vscode.postMessage({
                command: 'regexSearch',
                pattern: `(<${methodName}>|${methodName}æ¥å£)`,
                flags: 'i'
            });
        }
        
        // æŒ‰çº¿ç¨‹åç­›é€‰
        function filterByThreadName(threadName) {
            console.log('ğŸ§µ æŒ‰çº¿ç¨‹åç­›é€‰:', threadName);
            closeStatsModal();
            // æœç´¢ [çº¿ç¨‹å]
            vscode.postMessage({
                command: 'regexSearch',
                pattern: `\\[${threadName}\\]`,
                flags: 'i'
            });
        }
        
        function showDeleteByTimeDialog() {
            document.getElementById('deleteByTimeModal').style.display = 'block';
        }
        
        function closeDeleteByTimeModal() {
            document.getElementById('deleteByTimeModal').style.display = 'none';
            document.getElementById('deleteTimeInput').value = '';
        }
        
        // ========== åˆ é™¤æ–¹å¼é€‰æ‹© ==========
        function showDeleteModal() {
            document.getElementById('deleteModal').style.display = 'block';
        }
        
        function closeDeleteModal() {
            document.getElementById('deleteModal').style.display = 'none';
        }
        
        function selectDeleteByTime() {
            closeDeleteModal();
            showDeleteByTimeDialog();
        }
        
        function selectDeleteByLine() {
            closeDeleteModal();
            showDeleteByLineDialog();
        }
        
        function confirmDeleteByTime() {
            const timeStr = document.getElementById('deleteTimeInput').value.trim();
            const mode = document.getElementById('deleteTimeMode').value;
            
            if (!timeStr) {
                alert('è¯·è¾“å…¥æ—¶é—´ï¼');
                return;
            }
            
            // ç®€å•éªŒè¯æ—¶é—´æ ¼å¼
            if (!/^\d{4}-\d{2}-\d{2}/.test(timeStr)) {
                alert('æ—¶é—´æ ¼å¼ä¸æ­£ç¡®ï¼è¯·ä½¿ç”¨æ ¼å¼ï¼š2024-01-01 12:00:00 æˆ– 2024-01-01');
                return;
            }
            
            vscode.postMessage({
                command: 'deleteByTime',
                timeStr: timeStr,
                mode: mode
            });
            
            closeDeleteByTimeModal();
        }
        
        function showDeleteByLineDialog() {
            document.getElementById('deleteByLineModal').style.display = 'block';
        }
        
        function closeDeleteByLineModal() {
            document.getElementById('deleteByLineModal').style.display = 'none';
            document.getElementById('deleteLineInput').value = '';
        }
        
        function showJumpDialog() {
            document.getElementById('jumpModal').style.display = 'block';
            document.getElementById('jumpLineInput').focus();
        }
        
        function closeJumpModal() {
            document.getElementById('jumpModal').style.display = 'none';
            document.getElementById('jumpLineInput').value = '';
            document.getElementById('jumpTimeInput').value = '';
        }
        
        function switchJumpMode() {
            const mode = document.getElementById('jumpMode').value;
            const lineSection = document.getElementById('jumpByLineSection');
            const timeSection = document.getElementById('jumpByTimeSection');
            
            if (mode === 'line') {
                lineSection.style.display = 'block';
                timeSection.style.display = 'none';
                document.getElementById('jumpLineInput').focus();
            } else {
                lineSection.style.display = 'none';
                timeSection.style.display = 'block';
                document.getElementById('jumpTimeInput').focus();
            }
        }
        
        function confirmJump() {
            const mode = document.getElementById('jumpMode').value;
            
            if (mode === 'line') {
                const lineNumber = parseInt(document.getElementById('jumpLineInput').value);
                if (!lineNumber || lineNumber < 1) {
                    alert('è¯·è¾“å…¥æœ‰æ•ˆçš„è¡Œå·ï¼ˆå¤§äº0çš„æ•´æ•°ï¼‰ï¼');
                    return;
                }
                if (lineNumber > allLines.length) {
                    alert(`è¡Œå·è¶…å‡ºèŒƒå›´ï¼å½“å‰æ€»è¡Œæ•°ï¼š${allLines.length}`);
                    return;
                }
                jumpToLine(lineNumber);
            } else {
                const timeStr = document.getElementById('jumpTimeInput').value.trim();
                if (!timeStr) {
                    alert('è¯·è¾“å…¥æ—¶é—´ï¼');
                    return;
                }
                if (!/^\d{4}-\d{2}-\d{2}/.test(timeStr)) {
                    alert('æ—¶é—´æ ¼å¼ä¸æ­£ç¡®ï¼è¯·ä½¿ç”¨æ ¼å¼ï¼š2024-01-01 12:00:00 æˆ– 2024-01-01');
                    return;
                }
                jumpToTime(timeStr);
            }
            
            closeJumpModal();
        }
        
        function jumpToLine(lineNumber) {
            console.log('ğŸ¯ å®šä½åˆ°è¡Œå·:', lineNumber);
            
            // è®¡ç®—ç›®æ ‡è¡Œæ‰€åœ¨çš„é¡µé¢
            const targetPage = Math.ceil(lineNumber / pageSize);
            currentPage = targetPage;
            updatePagination();
            renderLines();
            
            // ç­‰å¾…æ¸²æŸ“å®Œæˆåé«˜äº®ç›®æ ‡è¡Œ
            setTimeout(() => {
                highlightTargetLine(lineNumber);
            }, 100);
        }
        
        function jumpToTime(timeStr) {
            console.log('ğŸ¯ å®šä½åˆ°æ—¶é—´:', timeStr);
            
            // ç›´æ¥è¯·æ±‚åç«¯æŸ¥æ‰¾
            vscode.postMessage({
                command: 'jumpToTime',
                timeStr: timeStr
            });
        }
        
        function handleJumpToTimeResult(data) {
            if (data.success) {
                console.log('âœ… æ‰¾åˆ°ç›®æ ‡æ—¶é—´çš„æ—¥å¿—ï¼Œè¡Œå·:', data.targetLineNumber);
                
                // åˆå¹¶æ–°åŠ è½½çš„æ•°æ®
                const newLines = data.lines;
                const startLine = data.startLine;
                
                // æ›´æ–° allLinesï¼šå¦‚æœæ–°æ•°æ®è¦†ç›–äº†å·²åŠ è½½çš„èŒƒå›´ï¼Œåˆ™åˆå¹¶
                if (allLines.length === 0 || startLine >= allLines.length) {
                    // æ–°æ•°æ®åœ¨å·²åŠ è½½æ•°æ®ä¹‹åï¼Œç›´æ¥è¿½åŠ 
                    allLines = allLines.concat(newLines);
                } else {
                    // æ›¿æ¢æˆ–æ’å…¥æ–°æ•°æ®
                    for (let i = 0; i < newLines.length; i++) {
                        const globalIndex = startLine + i;
                        if (globalIndex < allLines.length) {
                            allLines[globalIndex] = newLines[i];
                        } else {
                            allLines.push(newLines[i]);
                        }
                    }
                }
                
                // è·³è½¬åˆ°ç›®æ ‡è¡Œ
                jumpToLine(data.targetLineNumber);
            } else {
                console.error('âŒ æœªæ‰¾åˆ°ç›®æ ‡æ—¶é—´çš„æ—¥å¿—');
                alert(data.message || 'æœªæ‰¾åˆ°å¤§äºæˆ–ç­‰äºè¯¥æ—¶é—´çš„æ—¥å¿—ï¼');
            }
        }
        
        function highlightTargetLine(lineNumber) {
            // ç§»é™¤ä¹‹å‰çš„é«˜äº®
            document.querySelectorAll('.log-line.highlight-target').forEach(el => {
                el.classList.remove('highlight-target');
            });
            
            // æŸ¥æ‰¾ç›®æ ‡è¡Œ
            const logLines = document.querySelectorAll('.log-line');
            const startIndex = (currentPage - 1) * pageSize;
            const indexInPage = lineNumber - startIndex - 1;
            
            if (indexInPage >= 0 && indexInPage < logLines.length) {
                const targetLine = logLines[indexInPage];
                targetLine.classList.add('highlight-target');
                // æ»šåŠ¨åˆ°å¯è§åŒºåŸŸ
                targetLine.scrollIntoView({ behavior: 'smooth', block: 'center' });
                
                // 3ç§’åç§»é™¤é«˜äº®
                setTimeout(() => {
                    targetLine.classList.remove('highlight-target');
                }, 3000);
            }
        }
        
        function confirmDeleteByLine() {
            const lineNumber = parseInt(document.getElementById('deleteLineInput').value);
            const mode = document.getElementById('deleteLineMode').value;
            
            if (!lineNumber || lineNumber < 1) {
                alert('è¯·è¾“å…¥æœ‰æ•ˆçš„è¡Œå·ï¼ˆå¤§äº0çš„æ•´æ•°ï¼‰ï¼');
                return;
            }
            
            vscode.postMessage({
                command: 'deleteByLine',
                lineNumber: lineNumber,
                mode: mode
            });
            
            closeDeleteByLineModal();
        }
        
        function exportLogs() {
            vscode.postMessage({
                command: 'exportLogs',
                lines: allLines
            });
        }
        
        function refresh() {
            currentSearchKeyword = '';
            document.getElementById('searchInput').value = '';
            currentPage = 1;
            isFiltering = false; // é€€å‡ºè¿‡æ»¤æ¨¡å¼
            vscode.postMessage({
                command: 'refresh'
            });
        }
        
        // åˆ†é¡µåŠŸèƒ½
        function updatePagination() {
            totalPages = Math.ceil(allLines.length / pageSize);
            if (totalPages < 1) totalPages = 1;
            if (currentPage > totalPages) currentPage = totalPages;
            
            document.getElementById('currentPageInput').value = currentPage;
            document.getElementById('totalPages').textContent = totalPages;
            document.getElementById('totalLinesInPage').textContent = allLines.length;
            
            // æ›´æ–°æŒ‰é’®çŠ¶æ€
            document.getElementById('firstPageBtn').disabled = currentPage === 1;
            document.getElementById('prevPageBtn').disabled = currentPage === 1;
            document.getElementById('nextPageBtn').disabled = currentPage === totalPages;
            document.getElementById('lastPageBtn').disabled = currentPage === totalPages;
            
            // æ£€æŸ¥æ˜¯å¦éœ€è¦åŠ è½½æ›´å¤šæ•°æ®
            checkAndLoadMore();
        }
        
        function checkAndLoadMore() {
            // å¦‚æœå·²åŠ è½½å…¨éƒ¨æ•°æ®ï¼Œä¸å†åŠ è½½
            if (allDataLoaded) return;
            
            // å¦‚æœå¤„äºè¿‡æ»¤æ¨¡å¼ï¼Œä¸è‡ªåŠ¨åŠ è½½æ›´å¤šæ•°æ®
            if (isFiltering) {
                console.log('ğŸš« å¤„äºè¿‡æ»¤æ¨¡å¼ï¼Œä¸åŠ è½½æ›´å¤šæ•°æ®');
                return;
            }
            
            // å¦‚æœå½“å‰é¡µæ¥è¿‘å·²åŠ è½½æ•°æ®çš„æœ«å°¾ï¼Œè‡ªåŠ¨åŠ è½½æ›´å¤š
            const loadedLines = allLines.length;
            const currentMaxLine = currentPage * pageSize;
            
            if (currentMaxLine >= loadedLines - 500 && loadedLines < totalLinesInFile) {
                loadMoreData();
            }
        }
        
        function loadMoreData() {
            if (allDataLoaded) return;
            
            const currentLoaded = allLines.length;
            const remaining = totalLinesInFile - currentLoaded;
            const toLoad = Math.min(remaining, 10000); // æ¯æ¬¡åŠ è½½10000è¡Œ
            
            vscode.postMessage({
                command: 'loadMore',
                startLine: currentLoaded,
                count: toLoad
            });
        }
        
        function showLoadMoreHint() {
            // åœ¨é¡µé¢åº•éƒ¨æ˜¾ç¤ºåŠ è½½æ›´å¤šæŒ‰é’®
            const pagination = document.getElementById('pagination');
            let loadMoreBtn = document.getElementById('loadMoreBtn');
            
            if (!loadMoreBtn) {
                loadMoreBtn = document.createElement('button');
                loadMoreBtn.id = 'loadMoreBtn';
                loadMoreBtn.style.backgroundColor = '#0e7490';
                loadMoreBtn.style.marginLeft = '20px';
                loadMoreBtn.innerHTML = 'ğŸ“‚ åŠ è½½æ›´å¤šæ•°æ®';
                loadMoreBtn.onclick = function() {
                    loadAllRemainingData();
                };
                pagination.appendChild(loadMoreBtn);
            }
            
            loadMoreBtn.style.display = allDataLoaded ? 'none' : 'inline-block';
        }
        
        function loadAllRemainingData() {
            if (allDataLoaded) return;
            
            const remaining = totalLinesInFile - allLines.length;
            if (remaining <= 0) {
                allDataLoaded = true;
                return;
            }
            
            vscode.postMessage({
                command: 'loadMore',
                startLine: allLines.length,
                count: remaining
            });
            
            // éšè—åŠ è½½æŒ‰é’®
            const loadMoreBtn = document.getElementById('loadMoreBtn');
            if (loadMoreBtn) {
                loadMoreBtn.style.display = 'none';
            }
        }
        
        function goToFirstPage() {
            currentPage = 1;
            updatePagination();
            renderLines();
        }
        
        function goToPrevPage() {
            if (currentPage > 1) {
                currentPage--;
                updatePagination();
                renderLines();
            }
        }
        
        function goToNextPage() {
            if (currentPage < totalPages) {
                currentPage++;
                updatePagination();
                renderLines();
            }
        }
        
        function goToLastPage() {
            currentPage = totalPages;
            updatePagination();
            renderLines();
        }
        
        function goToPage(page) {
            page = parseInt(page);
            if (page >= 1 && page <= totalPages) {
                currentPage = page;
                updatePagination();
                renderLines();
            } else {
                document.getElementById('currentPageInput').value = currentPage;
            }
        }
        
        function changePageSize(size) {
            pageSize = parseInt(size);
            currentPage = 1;
            updatePagination();
            renderLines();
        }
        
        // æœç´¢æ¡†å›è½¦æœç´¢
        document.getElementById('searchInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                search();
            }
        });
        
        // é”®ç›˜å¿«æ·é”®æ”¯æŒ
        document.addEventListener('keydown', function(e) {
            // ä¸åœ¨è¾“å…¥æ¡†ä¸­æ—¶æ‰å“åº”
            if (e.target.tagName === 'INPUT') return;
            
            if (e.key === 'ArrowLeft' || e.key === 'PageUp') {
                e.preventDefault();
                goToPrevPage();
            } else if (e.key === 'ArrowRight' || e.key === 'PageDown') {
                e.preventDefault();
                goToNextPage();
            } else if (e.key === 'Home') {
                e.preventDefault();
                goToFirstPage();
            } else if (e.key === 'End') {
                e.preventDefault();
                goToLastPage();
            }
        });
    </script>
</body>
</html>
