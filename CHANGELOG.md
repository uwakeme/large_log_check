# Changelog

All notable changes to this project will be documented in this file.

The format is based on [Keep a Changelog](https://keepachangelog.com/en/1.1.0/),
and this project adheres to [Semantic Versioning](https://semver.org/spec/v2.0.0.html).

## [Unreleased]

### Added
- **多文件同时打开** - 支持同时打开多个日志文件
  - 每个日志文件在独立的 webview 面板中打开
  - 可以在不同面板之间自由切换
  - 每个面板独立管理自己的状态（书签、注释、高亮规则等）
  - 面板标题显示对应的文件名，方便识别
  - 关闭面板时自动释放资源

### Fixed
- 修复搜索/过滤后书签显示不存在的问题
  - 修复在搜索或过滤模式下打开书签列表时，之前添加的书签显示"（已不存在）"的问题
  - 书签查找现在从完整数据缓存中查找，而不是从当前过滤后的结果中查找
  - 导出书签日志功能也同步修复，确保能正确导出所有书签对应的日志

- 修复设置按钮点击无反应的问题
  - 修复设置模态框（settingsModal）被错误嵌套在自定义高亮规则弹窗内部的问题
  - 将设置模态框移出为独立的顶级元素，确保正常显示
  - 现在点击"⚙ 设置"按钮可以正常打开设置面板

- 修复线程名高亮规则误识别日志级别的问题
  - 修复 `[ERROR]`、`[WARN]`、`[INFO]`、`[DEBUG]` 等日志级别被错误识别为线程名的问题
  - 使用负向前瞻断言（negative lookahead）排除所有日志级别标识
  - 现在线程名高亮规则只匹配真正的线程名，如 `[http-nio-16710-exec-7]`、`[scheduling-1]` 等

### Added
- **加载进度提示** - 新增文件加载进度系统
  - **初始加载阶段**：全屏覆盖层显示加载进度
    - 显示当前加载阶段（计算行数、读取数据、渲染界面）
    - 显示百分比进度和具体行数
    - 每加载 10,000 行报告一次进度
  - **后台加载阶段**：右下角小型进度条
    - 前 2000 行加载完成后，全屏进度消失，界面立即可用
    - 右下角显示后台加载进度（如：15% (20,000 / 136,231 行)）
    - 可以随时暂停后台加载
    - 后台加载完成后自动消失，带淡出动画

### Added
- **导出书签日志** - 新增导出带书签的日志功能
  - 在书签管理弹窗底部新增"导出书签日志"按钮
  - 点击后可将所有带书签的日志行导出到单独的文件
  - 导出的日志按行号排序，方便查看
  - 默认文件名为 `bookmarked.log`，便于识别

### Added
- **统一过滤系统** - 重构搜索和过滤功能，实现条件叠加
  - 所有过滤条件（关键词搜索、线程名、类名、方法名、日志级别）现在可以同时生效
  - 例如：先通过线程名筛选，然后在搜索框输入关键词，两个条件会叠加应用
  - 解决了之前线程名筛选后搜索会失效的问题
  - 过滤条件在前端统一管理，提供更好的交互体验

- **当前页搜索** - 新增只在当前显示页面内搜索的功能
  - 搜索框旁新增"当前页"复选框
  - 勾选后搜索只在当前页的日志中进行，速度更快
  - 适合快速在当前查看的日志中定位关键信息
  - 支持关键词高亮显示
  - 可一键退出当前页搜索模式，恢复原始视图

### Changed
- **重构搜索架构** - 采用统一过滤系统
  - 搜索功能不再直接请求后端，改为在前端统一过滤
  - 当数据未完全加载时，会自动请求加载完整数据
  - 优化大文件处理，后台逐步加载完成后自动应用过滤
  - 提升多条件组合搜索的性能和准确性

### Removed
- **移除反向搜索功能** - 简化搜索界面，提升用户体验
  - 移除"反向搜索"复选框和相关逻辑代码
  - 如需排除特定内容，建议使用日志级别过滤或高级搜索

### Fixed
- 修复搜索和筛选互相覆盖的问题
- 修复线程名筛选后搜索失效的问题
- 修复日志级别过滤后无法再搜索的问题

## [1.2.1] - 2026-01-16
### Fixed
- **修复严重的日志显示问题** - HTML代码被显示为文本
  - 重构 `highlightKeywords` 函数，先在原始文本上匹配高亮规则，最后才转义HTML
  - 修复高亮标签与HTML实体混淆导致的显示错误
  - 确保筛选图标和高亮颜色正确渲染，不再显示源码
  - 解决重叠高亮区域的优先级问题，避免HTML结构破坏
  
- 修复搜索结果跳转重复加载数据的问题
  - 当数据已经完全加载到内存时，从搜索结果跳转不再重新加载数据
  - 直接在已加载的完整数据中跳转，确保页码和行号完全准确
  - 避免因重新加载部分数据导致的页码错位问题
  - 只有在数据未完全加载时才会请求后端重新加载
  
### Enhanced
- 优化搜索跳转体验
  - 增强跳转调试日志，显示数据加载状态和跳转方式
  - 智能判断是否需要重新加载数据，提升跳转响应速度
  - 跳转后正确恢复完整日志视图，清除搜索状态

## [1.2.0] - 2026-01-14
### Changed
- 多关键词搜索现在是默认搜索方式，无需勾选复选框
- 移除了"多关键词"复选框，简化界面操作
- 搜索框提示文字更新为"搜索日志内容（多关键词用空格分隔）"，更清晰地说明使用方式
- 正则模式下自动禁用多关键词匹配，避免冲突

### Enhanced
- 高级搜索功能全面升级
  - 支持添加多个搜索条件，可自由组合
  - 支持 AND（且）/ OR（或）逻辑选择
  - 新增字段级搜索：线程名、类名、方法名
  - 线程名/类名/方法名支持精确匹配和模糊匹配两种模式
  - 优化搜索界面，条件管理更直观
  - 每个条件可独立配置和删除

## [1.1.5] - 2026-01-12
### Added
- 新增多关键词搜索功能，支持通过空格分隔的多个关键词进行 AND 逻辑匹配，并支持对应的高亮显示

### Fixed
- 修复时间线加载不完整的问题
- 优化加载日志逻辑，提升用户体验
- 修复折叠重复日志模式下加载进度问题

### Changed
- 搜索框支持输入后自动触发搜索（带轻微防抖），可在设置中调整防抖时间
- 折叠重复日志的徽标会显示当前搜索命中的条数，便于快速判断重要性
- 新增设置面板，支持配置搜索防抖时间、折叠最小重复次数、时间线采样点数
- 统一后台增量加载逻辑，时间线始终基于整文件采样并在跳转后保持正确的当前位置高亮

## [1.1.4] - 2025-12-16
### Added
- 新增若干命令，包括以下命令
  - 刷新日志文件
  - 导出当前日志
  - 显示日志统计
  - 书签管理
  - 注释管理
  - 跳转到行号
  - 高级搜索
- 搜索结果导航优化
  - 搜索结果添加跳转按钮（🔗图标），点击可跳转到完整日志中的对应位置
  - 右键菜单新增"跳转到完整日志"选项，方便在搜索模式下快速定位
  - 取消搜索结果点击自动跳转功能，便于对比和复制内容
- 时间线导航增强
  - 时间线图上高亮显示当前浏览位置对应的时间块
  - 翻页或跳转时自动更新高亮块位置
  - 点击时间线跳转后，高亮块准确定位到目标位置
  - 基于实际时间戳计算高亮位置，确保与日志内容精确对应

### Fixed
- 修复搜索功能数据加载问题
  - 修复搜索时出现错误
  - 添加防御性检查，确保搜索结果数据始终为数组类型
  - 修复搜索结果为空时的提示信息
- 修复搜索结果显示问题
  - 修复搜索结果下方仍显示其他日志的问题
  - 防止在搜索/过滤模式下自动加载更多数据
  - 搜索结果现在只显示匹配的日志行

## [1.1.3] - 2025-12-09

### Added
- JSON自动解析支持多对象检测和渲染
  - 单行日志包含多个JSON对象时，自动分别解析展示
  - 保留日志前缀的原有格式和高亮样式
  - 每个JSON对象独立控制折叠/展开
- JSON折叠/展开交互优化
  - 修复折叠按钮显示逻辑，避免重复的结束括号
  - 支持展开后重新折叠，状态切换更加流畅
  - 优化嵌套JSON的渲染，只在根层级提供折叠控件

### Fixed
- 修复JSON解析时嵌套内容被意外折叠的问题
- 修复多JSON渲染时日志前缀格式丢失的问题
- 修复折叠/展开切换时DOM结构不一致的问题

## [1.1.2] - 2025-12-04

### Added
- JSON/XML自动解析功能
  - 自动检测并美化渲染日志中的JSON对象
  - 自动检测并美化渲染日志中的XML内容
  - 支持大型JSON的智能折叠（超过20行自动折叠）
  - 可通过开关控制是否启用自动解析
- 自定义高亮规则系统
  - 支持添加、编辑、删除自定义高亮规则
  - 支持文本精确匹配和正则表达式两种模式
  - 自定义背景色和文字颜色
  - 高亮内容可一键筛选日志
- 日志筛选功能增强
  - 支持从高亮内容快速筛选
  - 显示筛选状态提示
  - 支持取消筛选并恢复原始位置

### Changed
- 改进JSON提取算法，使用括号匹配代替正则表达式
- 优化折叠重复日志的性能
- 优化虚拟滚动渲染效率

### Fixed
- 修复JSON解析不完整的问题
- 修复嵌套JSON折叠逻辑错误

## [1.1.0] - 2025-12-03

### Added
- 虚拟滚动支持超大文件（GB级）秒开
- 智能分页加载机制
- 日志级别过滤（Error、Warn、Info、Debug）
- 时间范围过滤
- 折叠重复日志功能
- 书签标注功能
- 注释添加功能

### Added
- 多条件组合搜索
  - 支持正则表达式搜索
  - 支持反向搜索（排除匹配）
  - 支持多个搜索条件同时生效
- 搜索结果高亮显示
- 搜索结果计数

### Added
- 按时间删除日志
- 按行数删除日志
- 批量删除操作

### Added
- 日志统计信息
- 时间线导航
- 日志导出功能

### Changed
- 内置高亮规则优化
  - 时间戳高亮
  - 日志级别颜色区分
  - 线程名高亮
  - 类名高亮
  - 方法名高亮
- 暗色主题适配

## [1.0.0] - 2025-11-25

### Added
- 初始版本发布
- 基础日志查看功能
- 文件加载和显示
- 简单搜索功能
- 基本的界面布局