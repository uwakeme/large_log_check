# æŠ˜å é‡å¤æ—¥å¿—åŠŸèƒ½è¯¦ç»†æ–‡æ¡£

<cite>
**æœ¬æ–‡æ¡£å¼•ç”¨çš„æ–‡ä»¶**
- [webview.html](file://src/webview.html)
- [logViewerPanel.ts](file://src/logViewerPanel.ts)
- [extension.ts](file://src/extension.ts)
- [package.json](file://package.json)
</cite>

## ç›®å½•
1. [åŠŸèƒ½æ¦‚è¿°](#åŠŸèƒ½æ¦‚è¿°)
2. [æŠ€æœ¯æ¶æ„](#æŠ€æœ¯æ¶æ„)
3. [æ ¸å¿ƒç®—æ³•å®ç°](#æ ¸å¿ƒç®—æ³•å®ç°)
4. [å‰ç«¯å®ç°ç»†èŠ‚](#å‰ç«¯å®ç°ç»†èŠ‚)
5. [ç”¨æˆ·ç•Œé¢è®¾è®¡](#ç”¨æˆ·ç•Œé¢è®¾è®¡)
6. [æ€§èƒ½ä¼˜åŒ–ç­–ç•¥](#æ€§èƒ½ä¼˜åŒ–ç­–ç•¥)
7. [äº¤äº’æœºåˆ¶](#äº¤äº’æœºåˆ¶)
8. [æ‰©å±•æ€§è€ƒè™‘](#æ‰©å±•æ€§è€ƒè™‘)
9. [æ•…éšœæ’é™¤æŒ‡å—](#æ•…éšœæ’é™¤æŒ‡å—)
10. [æ€»ç»“](#æ€»ç»“)

## åŠŸèƒ½æ¦‚è¿°

æŠ˜å é‡å¤æ—¥å¿—åŠŸèƒ½æ˜¯large_log_checkæ‰©å±•ä¸­çš„ä¸€ä¸ªé‡è¦ç‰¹æ€§ï¼Œæ—¨åœ¨é€šè¿‡æ™ºèƒ½è¯†åˆ«å’Œåˆå¹¶è¿ç»­é‡å¤çš„æ—¥å¿—è¡Œæ¥æ˜¾è‘—æå‡å¤§æ–‡ä»¶æ—¥å¿—çš„å¯è¯»æ€§å’Œæµè§ˆæ•ˆç‡ã€‚è¯¥åŠŸèƒ½é‡‡ç”¨è½»é‡çº§çš„å‰ç«¯å¤„ç†æ–¹å¼ï¼Œåœ¨ç”¨æˆ·ç•Œé¢å±‚é¢å®ç°é‡å¤å†…å®¹çš„æ™ºèƒ½æŠ˜å ï¼Œæ— éœ€å¢åŠ åç«¯å¤„ç†è´Ÿæ‹…ã€‚

### ä¸»è¦ç‰¹æ€§

- **æ™ºèƒ½é‡å¤æ£€æµ‹**ï¼šæ”¯æŒå•è¡Œå’Œå¤šè¡Œæ¨¡å¼çš„é‡å¤æ£€æµ‹
- **åŠ¨æ€æŠ˜å ç®—æ³•**ï¼šæ ¹æ®é¡µé¢æ˜¾ç¤ºéœ€æ±‚åŠ¨æ€è°ƒæ•´åŠ è½½ç­–ç•¥
- **ç”¨æˆ·å¯æ§åˆ‡æ¢**ï¼šé€šè¿‡è¿‡æ»¤é¢æ¿çš„å¤é€‰æ¡†å®ç°ä¸€é”®å¼€å¯/å…³é—­
- **è§†è§‰åé¦ˆ**ï¼šæä¾›æ¸…æ™°çš„æŠ˜å çŠ¶æ€æŒ‡ç¤ºå’Œäº¤äº’åé¦ˆ
- **æ€§èƒ½ä¼˜åŒ–**ï¼šé‡‡ç”¨å¼‚æ­¥è®¡ç®—å’Œæ™ºèƒ½åŠ è½½ç­–ç•¥

## æŠ€æœ¯æ¶æ„

### æ•´ä½“æ¶æ„å›¾

```mermaid
graph TB
subgraph "ç”¨æˆ·ç•Œé¢å±‚"
UI[è¿‡æ»¤é¢æ¿]
CB[æŠ˜å å¤é€‰æ¡†]
LC[æ—¥å¿—å®¹å™¨]
end
subgraph "å‰ç«¯å¤„ç†å±‚"
TM[toggleCollapseMode]
CRL[collapseRepeatedLines]
RG[renderCollapsedGroup]
RSL[renderSingleLine]
end
subgraph "æ•°æ®ç®¡ç†å±‚"
AL[allLines]
PG[pageRanges]
EG[expandedGroups]
end
subgraph "ç®—æ³•å¼•æ“"
ELC[extractLogContent]
DP[Detection Pattern]
AC[Auto Collapse]
end
UI --> CB
CB --> TM
TM --> CRL
CRL --> ELC
ELC --> DP
DP --> AC
AC --> RG
AC --> RSL
RG --> LC
RSL --> LC
LC --> AL
LC --> PG
LC --> EG
```

**å›¾è¡¨æ¥æº**
- [webview.html](file://src/webview.html#L1830-L1852)
- [webview.html](file://src/webview.html#L1566-L1649)

### æ ¸å¿ƒç»„ä»¶å…³ç³»

```mermaid
classDiagram
class LogViewer {
+boolean isCollapseMode
+Set expandedGroups
+Map pageRanges
+toggleCollapseMode()
+collapseRepeatedLines()
+renderLines()
}
class CollapsedGroup {
+string groupId
+number patternLength
+number repeatCount
+boolean isExpanded
+Array lines
+Object firstLine
}
class PageCalculator {
+calculatePageRange()
+calculateAllPagesAsync()
+updatePagination()
}
LogViewer --> CollapsedGroup : "creates"
LogViewer --> PageCalculator : "uses"
CollapsedGroup --> LogViewer : "renders to"
```

**å›¾è¡¨æ¥æº**
- [webview.html](file://src/webview.html#L1174-L1177)
- [webview.html](file://src/webview.html#L1629-L1637)

## æ ¸å¿ƒç®—æ³•å®ç°

### é‡å¤æ£€æµ‹ç®—æ³•

æŠ˜å åŠŸèƒ½çš„æ ¸å¿ƒåœ¨äºæ™ºèƒ½è¯†åˆ«é‡å¤æ¨¡å¼çš„ç®—æ³•ï¼Œè¯¥ç®—æ³•èƒ½å¤Ÿæ£€æµ‹å•è¡Œæˆ–å¤šè¡Œçš„é‡å¤æ¨¡å¼ï¼š

#### ç®—æ³•æµç¨‹å›¾

```mermaid
flowchart TD
Start([å¼€å§‹æ£€æµ‹]) --> InitVars["åˆå§‹åŒ–å˜é‡<br/>bestPatternLength = 0<br/>bestRepeatCount = 0"]
InitVars --> TryPattern["å°è¯•ä¸åŒæ¨¡å¼é•¿åº¦<br/>patternLength = 1-10"]
TryPattern --> ExtractPattern["æå–å½“å‰æ¨¡å¼å†…å®¹<br/>å»é™¤æ—¶é—´æˆ³ç­‰å¹²æ‰°"]
ExtractPattern --> CountRepeats["è®¡ç®—æ¨¡å¼é‡å¤æ¬¡æ•°"]
CountRepeats --> CheckBetter{"æ˜¯å¦æ‰¾åˆ°æ›´å¥½æ¨¡å¼?<br/>repeatCount >= 2"}
CheckBetter --> |æ˜¯| UpdateBest["æ›´æ–°æœ€ä½³æ¨¡å¼<br/>bestPatternLength = patternLength<br/>bestRepeatCount = repeatCount"]
CheckBetter --> |å¦| NextPattern["å°è¯•ä¸‹ä¸€ä¸ªæ¨¡å¼é•¿åº¦"]
UpdateBest --> NextPattern
NextPattern --> MorePatterns{"è¿˜æœ‰æ›´å¤šæ¨¡å¼?"}
MorePatterns --> |æ˜¯| TryPattern
MorePatterns --> |å¦| FoundPattern{"æ‰¾åˆ°æœ‰æ•ˆæ¨¡å¼?"}
FoundPattern --> |æ˜¯| CreateGroup["åˆ›å»ºæŠ˜å ç»„<br/>isCollapsed = true"]
FoundPattern --> |å¦| AddDirectly["ç›´æ¥æ·»åŠ åˆ°ç»“æœ<br/>isCollapsed = false"]
CreateGroup --> End([ç»“æŸ])
AddDirectly --> End
```

**å›¾è¡¨æ¥æº**
- [webview.html](file://src/webview.html#L1577-L1644)

#### å…³é”®ç®—æ³•å®ç°

ç®—æ³•çš„æ ¸å¿ƒé€»è¾‘åŒ…å«ä»¥ä¸‹æ­¥éª¤ï¼š

1. **æ¨¡å¼æå–**ï¼šä½¿ç”¨`extractLogContent()`å‡½æ•°å»é™¤æ—¶é—´æˆ³ç­‰å¹²æ‰°å› ç´ 
2. **é‡å¤è®¡æ•°**ï¼šé€šè¿‡åµŒå¥—å¾ªç¯æ£€æµ‹æ¨¡å¼é‡å¤æ¬¡æ•°
3. **æœ€ä½³åŒ¹é…**ï¼šé€‰æ‹©é‡å¤æ¬¡æ•°æœ€å¤šçš„æ¨¡å¼ä½œä¸ºæŠ˜å ä¾æ®
4. **æ™ºèƒ½åˆ¤æ–­**ï¼šè¦æ±‚é‡å¤æ¬¡æ•°è‡³å°‘ä¸º2æ¬¡æ‰è¿›è¡ŒæŠ˜å 

**ç« èŠ‚æ¥æº**
- [webview.html](file://src/webview.html#L1566-L1649)

### æ—¶é—´æˆ³æ¸…ç†ç®—æ³•

ä¸ºäº†å‡†ç¡®è¯†åˆ«é‡å¤æ¨¡å¼ï¼Œç³»ç»Ÿå®ç°äº†æ™ºèƒ½çš„æ—¶é—´æˆ³æ¸…ç†åŠŸèƒ½ï¼š

```mermaid
flowchart LR
Input[åŸå§‹æ—¥å¿—è¡Œ] --> TS1["ç§»é™¤ ISO æ ¼å¼<br/>2025-11-20 08:16:50.054"]
TS1 --> TS2["ç§»é™¤æ–¹æ‹¬å·æ ¼å¼<br/>[2025-11-20 08:16:50.054]"]
TS2 --> TS3["ç§»é™¤çŸ­æ ¼å¼<br/>2025-11-20 08:16:50"]
TS3 --> TS4["ç§»é™¤æ–œæ æ ¼å¼<br/>2025/11/20 08:16:50.054"]
TS4 --> Output[æ¸…ç†åå†…å®¹]
```

**å›¾è¡¨æ¥æº**
- [webview.html](file://src/webview.html#L1542-L1562)

**ç« èŠ‚æ¥æº**
- [webview.html](file://src/webview.html#L1542-L1562)

## å‰ç«¯å®ç°ç»†èŠ‚

### HTMLç»“æ„è®¾è®¡

æŠ˜å åŠŸèƒ½çš„HTMLç»“æ„é‡‡ç”¨äº†è¯­ä¹‰åŒ–çš„è®¾è®¡åŸåˆ™ï¼Œç¡®ä¿è‰¯å¥½çš„å¯è®¿é—®æ€§å’Œå¯ç»´æŠ¤æ€§ï¼š

#### æŠ˜å ç»„HTMLç»“æ„

```html
<div class="log-line collapsed" data-group-id="group_123">
    <span class="log-line-number">123</span>
    <span class="log-line-content">
        æ—¥å¿—å†…å®¹...
        <span class="repeat-count" title="ç‚¹å‡»å±•å¼€è¯¦æƒ…">
            é‡å¤ 15 æ¬¡
        </span>
    </span>
</div>
```

#### å•è¡Œæ—¥å¿—HTMLç»“æ„

```html
<div class="log-line info">
    <span class="log-line-number">123</span>
    <span class="log-line-content">
        INFO æ—¥å¿—å†…å®¹...
    </span>
</div>
```

**ç« èŠ‚æ¥æº**
- [webview.html](file://src/webview.html#L1652-L1693)
- [webview.html](file://src/webview.html#L1728-L1817)

### CSSæ ·å¼ç³»ç»Ÿ

#### æŠ˜å æ ·å¼å®šä¹‰

```css
/* æŠ˜å æ—¥å¿—è¡Œæ ·å¼ */
.log-line.collapsed {
    background-color: rgba(139, 92, 246, 0.1);
    border-left: 3px solid #8b5cf6;
    cursor: pointer;
}

.log-line.collapsed:hover {
    background-color: rgba(139, 92, 246, 0.2);
}

/* é‡å¤æ¬¡æ•°å¾½ç« æ ·å¼ */
.repeat-count {
    display: inline-block;
    background-color: #8b5cf6;
    color: white;
    padding: 2px 8px;
    border-radius: 10px;
    font-size: 11px;
    font-weight: bold;
    margin-left: 10px;
    cursor: pointer;
}
```

#### å±•å¼€åçš„æ ·å¼

```css
/* å±•å¼€åçš„å­è¡Œæ ·å¼ */
.log-line {
    margin-left: 20px;
    opacity: 0.8;
    border-top: 1px dashed rgba(139, 92, 246, 0.3);
    margin-top: 3px;
    padding-top: 3px;
}
```

**ç« èŠ‚æ¥æº**
- [webview.html](file://src/webview.html#L213-L234)
- [webview.html](file://src/webview.html#L1700-L1708)

### JavaScriptæ ¸å¿ƒé€»è¾‘

#### toggleCollapseModeå‡½æ•°

è¯¥å‡½æ•°æ˜¯æŠ˜å åŠŸèƒ½çš„å…¥å£ç‚¹ï¼Œè´Ÿè´£å¤„ç†ç”¨æˆ·ç•Œé¢çš„çŠ¶æ€åˆ‡æ¢ï¼š

```javascript
function toggleCollapseMode() {
    isCollapseMode = document.getElementById('collapseRepeated').checked;
    console.log('ğŸ” åˆ‡æ¢æŠ˜å æ¨¡å¼:', isCollapseMode);
    
    // æ¸…ç©ºé¡µé¢èŒƒå›´è®°å½•ï¼Œé‡æ–°è®¡ç®—
    pageRanges.clear();
    currentPage = 1;
    expandedGroups.clear(); // æ¸…ç©ºå±•å¼€çŠ¶æ€
    
    // å¦‚æœå–æ¶ˆæŠ˜å æ¨¡å¼ï¼Œé‡ç½®è®¡ç®—çŠ¶æ€
    if (!isCollapseMode) {
        isCalculatingPages = false;
        calculationProgress = 0;
    }
    
    renderLines();
    updatePagination(); // æ‰‹åŠ¨å†æ¬¡è°ƒç”¨ä»¥ç¡®ä¿çŠ¶æ€æ­£ç¡®
    
    // å¦‚æœå¼€å¯æŠ˜å æ¨¡å¼ï¼Œå¼‚æ­¥è®¡ç®—æ‰€æœ‰é¡µé¢
    if (isCollapseMode) {
        calculateAllPagesAsync();
    }
}
```

**ç« èŠ‚æ¥æº**
- [webview.html](file://src/webview.html#L1829-L1852)

#### collapseRepeatedLinesç®—æ³•

è¿™æ˜¯æ•´ä¸ªæŠ˜å åŠŸèƒ½çš„æ ¸å¿ƒç®—æ³•ï¼Œå®ç°äº†æ™ºèƒ½çš„é‡å¤æ£€æµ‹ï¼š

```javascript
function collapseRepeatedLines(lines, startIndex) {
    const result = [];
    let i = 0;
    let totalCollapsed = 0;
    
    while (i < lines.length) {
        // å°è¯•ä¸åŒçš„æ¨¡å¼é•¿åº¦ï¼ˆ1è¡Œã€2è¡Œã€3è¡Œ...æœ€å¤š10è¡Œï¼‰
        let bestPatternLength = 0;
        let bestRepeatCount = 0;
        
        for (let patternLength = 1; patternLength <= Math.min(10, Math.floor((lines.length - i) / 2)); patternLength++) {
            // è·å–å½“å‰æ¨¡å¼ï¼ˆå»é™¤æ—¶é—´æˆ³ï¼‰
            const pattern = [];
            for (let k = 0; k < patternLength; k++) {
                if (i + k >= lines.length) break;
                const content = extractLogContent(lines[i + k]);
                pattern.push(content);
            }
            
            // æ£€æµ‹è¿™ä¸ªæ¨¡å¼é‡å¤äº†å¤šå°‘æ¬¡
            let repeatCount = 1;
            let j = i + patternLength;
            
            while (j + patternLength <= lines.length) {
                let matches = true;
                for (let k = 0; k < patternLength; k++) {
                    const currentContent = extractLogContent(lines[j + k]);
                    if (currentContent !== pattern[k]) {
                        matches = false;
                        break;
                    }
                }
                
                if (matches) {
                    repeatCount++;
                    j += patternLength;
                } else {
                    break;
                }
            }
            
            // å¦‚æœè¿™ä¸ªæ¨¡å¼è‡³å°‘é‡å¤2æ¬¡ï¼Œä¸”æ¯”ä¹‹å‰æ‰¾åˆ°çš„æ›´å¥½
            if (repeatCount >= 2 && repeatCount > bestRepeatCount) {
                bestPatternLength = patternLength;
                bestRepeatCount = repeatCount;
            }
        }
        
        if (bestPatternLength > 0 && bestRepeatCount >= 2) {
            // æ‰¾åˆ°äº†é‡å¤æ¨¡å¼
            const firstLineNumber = lines[i].lineNumber || (startIndex + i + 1);
            const groupId = `group_${firstLineNumber}`;
            const totalLines = bestPatternLength * bestRepeatCount;
            
            result.push({
                isCollapsed: true,
                groupId: groupId,
                patternLength: bestPatternLength,
                repeatCount: bestRepeatCount,
                lines: lines.slice(i, i + totalLines),
                firstLine: lines[i],
                isExpanded: expandedGroups.has(groupId)
            });
            
            i += totalLines;
        } else {
            // æ²¡æœ‰é‡å¤ï¼Œç›´æ¥æ·»åŠ 
            result.push(lines[i]);
            i++;
        }
    }
    
    return result;
}
```

**ç« èŠ‚æ¥æº**
- [webview.html](file://src/webview.html#L1566-L1649)

## ç”¨æˆ·ç•Œé¢è®¾è®¡

### è¿‡æ»¤é¢æ¿é›†æˆ

æŠ˜å åŠŸèƒ½é€šè¿‡è¿‡æ»¤é¢æ¿ä¸­çš„å¤é€‰æ¡†ä¸ç”¨æˆ·ç•Œé¢æ— ç¼é›†æˆï¼š

```html
<label style="font-size: 12px; display: flex; align-items: center; gap: 5px; cursor: pointer;">
    <input type="checkbox" id="collapseRepeated" onchange="toggleCollapseMode()">
    <span>ğŸ“ æŠ˜å é‡å¤æ—¥å¿—</span>
</label>
```

### äº¤äº’åé¦ˆè®¾è®¡

#### æŠ˜å çŠ¶æ€æŒ‡ç¤º

- **è§†è§‰æ ‡è¯†**ï¼šä½¿ç”¨ç´«è‰²è¾¹æ¡†å’ŒèƒŒæ™¯è‰²åŒºåˆ†æŠ˜å è¡Œ
- **çŠ¶æ€æç¤º**ï¼šé¼ æ ‡æ‚¬åœæ—¶æ˜¾ç¤ºå±•å¼€/æŠ˜å æç¤º
- **é‡å¤è®¡æ•°**ï¼šæ˜¾ç¤ºå…·ä½“çš„é‡å¤æ¬¡æ•°ä¿¡æ¯

#### ç”¨æˆ·æ“ä½œåé¦ˆ

- **ç‚¹å‡»å±•å¼€**ï¼šç‚¹å‡»æŠ˜å è¡Œå¯å±•å¼€æŸ¥çœ‹è¯¦ç»†å†…å®¹
- **å±•å¼€çŠ¶æ€è®°å¿†**ï¼šè®°ä½ç”¨æˆ·çš„å±•å¼€/æŠ˜å åå¥½
- **å®æ—¶æ›´æ–°**ï¼šåˆ‡æ¢æŠ˜å æ¨¡å¼æ—¶ç«‹å³æ›´æ–°æ˜¾ç¤º

**ç« èŠ‚æ¥æº**
- [webview.html](file://src/webview.html#L720-L723)

## æ€§èƒ½ä¼˜åŒ–ç­–ç•¥

### æ™ºèƒ½åŠ è½½æœºåˆ¶

#### åˆ†é¡µè®¡ç®—ä¼˜åŒ–

```mermaid
sequenceDiagram
participant User as ç”¨æˆ·
participant UI as ç”¨æˆ·ç•Œé¢
participant Calc as é¡µé¢è®¡ç®—å™¨
participant Render as æ¸²æŸ“å¼•æ“
User->>UI : åˆ‡æ¢æŠ˜å æ¨¡å¼
UI->>Calc : calculateAllPagesAsync()
Calc->>Calc : æ‰¹é‡è®¡ç®—é¡µé¢èŒƒå›´
loop æ¯5é¡µ
Calc->>Calc : è®¡ç®—é¡µé¢èŒƒå›´
Calc->>UI : æ›´æ–°è¿›åº¦æ˜¾ç¤º
end
Calc->>Render : æ¸²æŸ“å®Œæˆ
Render->>UI : æ˜¾ç¤ºæœ€ç»ˆç»“æœ
```

**å›¾è¡¨æ¥æº**
- [webview.html](file://src/webview.html#L1486-L1541)

#### å¼‚æ­¥è®¡ç®—ç­–ç•¥

ç³»ç»Ÿé‡‡ç”¨å¼‚æ­¥è®¡ç®—ç­–ç•¥æ¥é¿å…é˜»å¡ç”¨æˆ·ç•Œé¢ï¼š

1. **åˆ†æ‰¹å¤„ç†**ï¼šæ¯æ¬¡è®¡ç®—5é¡µï¼Œç„¶åè®©å‡ºCPUæ—¶é—´
2. **è¿›åº¦åé¦ˆ**ï¼šå®æ—¶æ˜¾ç¤ºè®¡ç®—è¿›åº¦
3. **ä¸­æ–­æœºåˆ¶**ï¼šç”¨æˆ·åˆ‡æ¢æ¨¡å¼æ—¶å¯ç«‹å³åœæ­¢è®¡ç®—

**ç« èŠ‚æ¥æº**
- [webview.html](file://src/webview.html#L1486-L1541)

### å†…å­˜ç®¡ç†ä¼˜åŒ–

#### æ•°æ®ç»“æ„ä¼˜åŒ–

- **Seté›†åˆ**ï¼šä½¿ç”¨Setå­˜å‚¨å±•å¼€çŠ¶æ€ï¼Œæé«˜æŸ¥æ‰¾æ•ˆç‡
- **Mapç¼“å­˜**ï¼šä½¿ç”¨Mapç¼“å­˜é¡µé¢èŒƒå›´ï¼Œé¿å…é‡å¤è®¡ç®—
- **æ‡’åŠ è½½**ï¼šåªåœ¨éœ€è¦æ—¶æ‰è®¡ç®—é¡µé¢èŒƒå›´

#### æ¸²æŸ“ä¼˜åŒ–

- **è™šæ‹Ÿæ»šåŠ¨**ï¼šåªæ¸²æŸ“å¯è§åŒºåŸŸçš„å†…å®¹
- **DOMå¤ç”¨**ï¼šé‡ç”¨DOMå…ƒç´ ï¼Œå‡å°‘åˆ›å»ºé”€æ¯å¼€é”€
- **æ‰¹é‡æ›´æ–°**ï¼šåˆå¹¶å¤šä¸ªDOMæ›´æ–°æ“ä½œ

**ç« èŠ‚æ¥æº**
- [webview.html](file://src/webview.html#L1174-L1177)

## äº¤äº’æœºåˆ¶

### ç”¨æˆ·æ“ä½œæµç¨‹

#### æŠ˜å æ¨¡å¼åˆ‡æ¢æµç¨‹

```mermaid
flowchart TD
UserClick[ç”¨æˆ·ç‚¹å‡»å¤é€‰æ¡†] --> ToggleMode[toggleCollapseMode]
ToggleMode --> ClearCache[æ¸…ç©ºç¼“å­˜æ•°æ®]
ClearCache --> ResetState[é‡ç½®çŠ¶æ€å˜é‡]
ResetState --> CheckMode{æ£€æŸ¥æŠ˜å æ¨¡å¼}
CheckMode --> |å¼€å¯| AsyncCalc[å¼‚æ­¥è®¡ç®—é¡µé¢]
CheckMode --> |å…³é—­| SyncRender[åŒæ­¥æ¸²æŸ“]
AsyncCalc --> UpdateUI[æ›´æ–°ç”¨æˆ·ç•Œé¢]
SyncRender --> UpdateUI
UpdateUI --> Complete[å®Œæˆåˆ‡æ¢]
```

**å›¾è¡¨æ¥æº**
- [webview.html](file://src/webview.html#L1829-L1852)

#### æŠ˜å /å±•å¼€äº¤äº’

```mermaid
sequenceDiagram
participant User as ç”¨æˆ·
participant Line as æ—¥å¿—è¡Œ
participant Group as æŠ˜å ç»„
participant DOM as DOMæ ‘
User->>Line : ç‚¹å‡»æŠ˜å è¡Œ
Line->>Group : toggleGroup(groupId)
Group->>Group : åˆ‡æ¢expandedGroupsçŠ¶æ€
Group->>DOM : renderLines()
DOM->>DOM : é‡æ–°æ¸²æŸ“é¡µé¢
DOM->>User : æ˜¾ç¤ºå±•å¼€/æŠ˜å çŠ¶æ€
```

**å›¾è¡¨æ¥æº**
- [webview.html](file://src/webview.html#L1819-L1827)

### çŠ¶æ€æŒä¹…åŒ–

#### å±•å¼€çŠ¶æ€è®°å¿†

ç³»ç»Ÿé€šè¿‡`expandedGroups` Setæ¥è®°å¿†ç”¨æˆ·çš„å±•å¼€åå¥½ï¼š

```javascript
// åˆ‡æ¢æŠ˜å ç»„çŠ¶æ€
function toggleGroup(groupId) {
    if (expandedGroups.has(groupId)) {
        expandedGroups.delete(groupId);
    } else {
        expandedGroups.add(groupId);
    }
    renderLines();
}
```

#### é¡µé¢èŒƒå›´ç¼“å­˜

ä½¿ç”¨`pageRanges` Mapç¼“å­˜é¡µé¢èŒƒå›´ä¿¡æ¯ï¼Œé¿å…é‡å¤è®¡ç®—ï¼š

```javascript
// è®°å½•é¡µé¢èŒƒå›´
pageRanges.set(currentPage, { start: startIndex, end: endIndex });

// æ£€æŸ¥æ˜¯å¦å­˜åœ¨ç¼“å­˜
if (pageRanges.has(currentPage)) {
    const range = pageRanges.get(currentPage);
    startIndex = range.start;
    endIndex = range.end;
}
```

**ç« èŠ‚æ¥æº**
- [webview.html](file://src/webview.html#L1819-L1827)
- [webview.html](file://src/webview.html#L1330-L1336)

## æ‰©å±•æ€§è€ƒè™‘

### ç®—æ³•å¯æ‰©å±•æ€§

#### æ¨¡å¼æ£€æµ‹å¢å¼º

å½“å‰ç®—æ³•æ”¯æŒ1-10è¡Œçš„æ¨¡å¼æ£€æµ‹ï¼Œå¯æ ¹æ®éœ€è¦æ‰©å±•ï¼š

- **åŠ¨æ€è°ƒæ•´çª—å£å¤§å°**ï¼šæ ¹æ®æ—¥å¿—ç‰¹å¾è‡ªåŠ¨è°ƒæ•´æ£€æµ‹çª—å£
- **å¤šçº§æ£€æµ‹**ï¼šåŒæ—¶æ£€æµ‹å•è¡Œå’Œå¤šè¡Œæ¨¡å¼
- **æƒé‡è¯„åˆ†**ï¼šä¸ºä¸åŒæ¨¡å¼åˆ†é…æƒé‡ï¼Œé€‰æ‹©æœ€ä¼˜æ–¹æ¡ˆ

#### æ€§èƒ½æ‰©å±•

- **å¹¶è¡Œè®¡ç®—**ï¼šåˆ©ç”¨Web Workersè¿›è¡Œå¹¶è¡Œè®¡ç®—
- **å¢é‡æ›´æ–°**ï¼šåªé‡æ–°è®¡ç®—å˜åŒ–çš„éƒ¨åˆ†
- **æ™ºèƒ½é¢„æµ‹**ï¼šåŸºäºå†å²æ•°æ®é¢„æµ‹æœ€ä½³è®¾ç½®

### åŠŸèƒ½æ‰©å±•

#### é«˜çº§æŠ˜å é€‰é¡¹

- **è‡ªå®šä¹‰é˜ˆå€¼**ï¼šå…è®¸ç”¨æˆ·è®¾ç½®æœ€å°é‡å¤æ¬¡æ•°
- **æ¨¡å¼ä¼˜å…ˆçº§**ï¼šæ”¯æŒå¤šç§æŠ˜å æ¨¡å¼çš„ä¼˜å…ˆçº§è®¾ç½®
- **æ¡ä»¶æŠ˜å **ï¼šåŸºäºæ—¥å¿—çº§åˆ«æˆ–å…¶ä»–æ¡ä»¶çš„æŠ˜å 

#### ç”¨æˆ·ä½“éªŒå¢å¼º

- **åŠ¨ç”»æ•ˆæœ**ï¼šæ·»åŠ å±•å¼€/æŠ˜å çš„å¹³æ»‘åŠ¨ç”»
- **é”®ç›˜å¿«æ·é”®**ï¼šæ”¯æŒé”®ç›˜æ“ä½œæŠ˜å åŠŸèƒ½
- **æ‹–æ‹½è°ƒæ•´**ï¼šå…è®¸ç”¨æˆ·æ‹–æ‹½è°ƒæ•´æŠ˜å èŒƒå›´

## æ•…éšœæ’é™¤æŒ‡å—

### å¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ

#### æŠ˜å åŠŸèƒ½ä¸ç”Ÿæ•ˆ

**é—®é¢˜ç—‡çŠ¶**ï¼šå¯ç”¨æŠ˜å æ¨¡å¼åä»ç„¶æ˜¾ç¤ºåŸå§‹æ—¥å¿—è¡Œ

**å¯èƒ½åŸå› **ï¼š
1. æ—¥å¿—å†…å®¹è¿‡äºå¤æ‚ï¼Œæ— æ³•è¯†åˆ«é‡å¤æ¨¡å¼
2. ç³»ç»Ÿèµ„æºä¸è¶³å¯¼è‡´è®¡ç®—è¶…æ—¶
3. æµè§ˆå™¨å…¼å®¹æ€§é—®é¢˜

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. æ£€æŸ¥æ—¥å¿—æ ¼å¼æ˜¯å¦è¿‡äºå¤æ‚
2. å¢åŠ ç³»ç»Ÿå†…å­˜æˆ–ä¼˜åŒ–æµè§ˆå™¨è®¾ç½®
3. æ›´æ–°æµè§ˆå™¨ç‰ˆæœ¬

#### æ€§èƒ½é—®é¢˜

**é—®é¢˜ç—‡çŠ¶**ï¼šå¯ç”¨æŠ˜å æ¨¡å¼åé¡µé¢å“åº”ç¼“æ…¢

**è¯Šæ–­æ­¥éª¤**ï¼š
1. æ£€æŸ¥æ—¥å¿—æ–‡ä»¶å¤§å°
2. ç›‘æ§æµè§ˆå™¨æ€§èƒ½æŒ‡æ ‡
3. æŸ¥çœ‹æ§åˆ¶å°é”™è¯¯ä¿¡æ¯

**ä¼˜åŒ–å»ºè®®**ï¼š
1. å‡å°‘åŒæ—¶åŠ è½½çš„æ—¥å¿—è¡Œæ•°
2. ä½¿ç”¨æ›´é«˜æ•ˆçš„ç®—æ³•å˜ä½“
3. å®æ–½æ›´ä¸¥æ ¼çš„è®¡ç®—è¶…æ—¶æœºåˆ¶

#### çŠ¶æ€ä¸¢å¤±

**é—®é¢˜ç—‡çŠ¶**ï¼šåˆ‡æ¢æŠ˜å æ¨¡å¼åå±•å¼€çŠ¶æ€è¢«é‡ç½®

**è§£å†³æ–¹æ³•**ï¼š
1. æ£€æŸ¥expandedGroupsæ•°æ®ç»“æ„
2. éªŒè¯çŠ¶æ€ä¿å­˜æœºåˆ¶
3. ç¡®è®¤DOMæ›´æ–°é€»è¾‘

**ç« èŠ‚æ¥æº**
- [webview.html](file://src/webview.html#L1829-L1852)

## æ€»ç»“

large_log_checkçš„æŠ˜å é‡å¤æ—¥å¿—åŠŸèƒ½æ˜¯ä¸€ä¸ªç²¾å¿ƒè®¾è®¡çš„å‰ç«¯ä¼˜åŒ–è§£å†³æ–¹æ¡ˆï¼Œé€šè¿‡æ™ºèƒ½ç®—æ³•å’Œä¼˜é›…çš„ç”¨æˆ·ç•Œé¢å®ç°äº†å¤§æ–‡ä»¶æ—¥å¿—çš„æœ‰æ•ˆç®¡ç†ã€‚è¯¥åŠŸèƒ½çš„ä¸»è¦ä¼˜åŠ¿åŒ…æ‹¬ï¼š

### æŠ€æœ¯äº®ç‚¹

1. **æ™ºèƒ½ç®—æ³•**ï¼šèƒ½å¤Ÿè¯†åˆ«å•è¡Œå’Œå¤šè¡Œçš„é‡å¤æ¨¡å¼ï¼Œé€‚åº”å„ç§æ—¥å¿—æ ¼å¼
2. **æ€§èƒ½ä¼˜åŒ–**ï¼šé‡‡ç”¨å¼‚æ­¥è®¡ç®—å’Œæ™ºèƒ½åŠ è½½ç­–ç•¥ï¼Œç¡®ä¿è‰¯å¥½çš„ç”¨æˆ·ä½“éªŒ
3. **ç”¨æˆ·å‹å¥½**ï¼šæä¾›ç›´è§‚çš„è§†è§‰åé¦ˆå’Œçµæ´»çš„äº¤äº’æ–¹å¼
4. **å¯æ‰©å±•æ€§**ï¼šæ¨¡å—åŒ–è®¾è®¡ä¾¿äºåŠŸèƒ½æ‰©å±•å’Œæ€§èƒ½ä¼˜åŒ–

### åº”ç”¨ä»·å€¼

- **æå‡å¯è¯»æ€§**ï¼šæ˜¾è‘—å‡å°‘é‡å¤å†…å®¹ï¼Œçªå‡ºé‡è¦ä¿¡æ¯
- **æ”¹å–„æ€§èƒ½**ï¼šé€šè¿‡å‰ç«¯å¤„ç†å‡è½»æœåŠ¡å™¨è´Ÿæ‹…
- **å¢å¼ºä½“éªŒ**ï¼šæä¾›æµç•…çš„äº¤äº’å’ŒçŠ¶æ€è®°å¿†åŠŸèƒ½
- **é€‚åº”åœºæ™¯**ï¼šé€‚ç”¨äºå„ç§è§„æ¨¡çš„æ—¥å¿—æ–‡ä»¶å¤„ç†

è¯¥åŠŸèƒ½å±•ç¤ºäº†ç°ä»£Webåº”ç”¨ä¸­å‰ç«¯ç®—æ³•ä¼˜åŒ–çš„æœ€ä½³å®è·µï¼Œä¸ºå¤„ç†å¤§è§„æ¨¡æ•°æ®æä¾›äº†æœ‰ä»·å€¼çš„å‚è€ƒå®ç°ã€‚éšç€ç®—æ³•çš„ä¸æ–­ä¼˜åŒ–å’ŒåŠŸèƒ½çš„æŒç»­æ‰©å±•ï¼Œè¿™ä¸€ç‰¹æ€§å°†ç»§ç»­ä¸ºç”¨æˆ·æä¾›æ›´åŠ é«˜æ•ˆå’Œæ„‰æ‚¦çš„æ—¥å¿—åˆ†æä½“éªŒã€‚