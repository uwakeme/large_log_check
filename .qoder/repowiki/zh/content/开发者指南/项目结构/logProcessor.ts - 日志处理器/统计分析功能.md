# ç»Ÿè®¡åˆ†æåŠŸèƒ½

<cite>
**æœ¬æ–‡æ¡£ä¸­å¼•ç”¨çš„æ–‡ä»¶**
- [logProcessor.ts](file://src/logProcessor.ts)
- [logViewerPanel.ts](file://src/logViewerPanel.ts)
- [extension.ts](file://src/extension.ts)
- [webview.html](file://src/webview.html)
- [README.md](file://README.md)
</cite>

## ç›®å½•
1. [ç®€ä»‹](#ç®€ä»‹)
2. [é¡¹ç›®æ¶æ„æ¦‚è§ˆ](#é¡¹ç›®æ¶æ„æ¦‚è§ˆ)
3. [LogStatsæ¥å£è®¾è®¡](#logstatsæ¥å£è®¾è®¡)
4. [getStatisticsæ–¹æ³•å®ç°](#getstatisticsæ–¹æ³•å®ç°)
5. [ç»Ÿè®¡å­—æ®µè¯¦è§£](#ç»Ÿè®¡å­—æ®µè¯¦è§£)
6. [Mapæ•°æ®ç»“æ„çš„ä¼˜åŠ¿](#mapæ•°æ®ç»“æ„çš„ä¼˜åŠ¿)
7. [æ€§èƒ½ä¼˜åŒ–ç­–ç•¥](#æ€§èƒ½ä¼˜åŒ–ç­–ç•¥)
8. [å‰ç«¯ç»Ÿè®¡å±•ç¤º](#å‰ç«¯ç»Ÿè®¡å±•ç¤º)
9. [ä½¿ç”¨ç¤ºä¾‹](#ä½¿ç”¨ç¤ºä¾‹)
10. [æ•…éšœæ’é™¤æŒ‡å—](#æ•…éšœæ’é™¤æŒ‡å—)
11. [æ€»ç»“](#æ€»ç»“)

## ç®€ä»‹

å¤§å‹æ—¥å¿—æ–‡ä»¶æŸ¥çœ‹å™¨æ˜¯ä¸€ä¸ªä¸“ä¸ºå¤„ç†è¶…å¤§æ—¥å¿—æ–‡ä»¶è€Œè®¾è®¡çš„VSCodeæ‰©å±•ï¼Œå…¶æ ¸å¿ƒç»Ÿè®¡åˆ†æåŠŸèƒ½é€šè¿‡å•æ¬¡æµå¼éå†å®ç°äº†é«˜æ•ˆçš„æ•°æ®æ”¶é›†å’Œåˆ†æã€‚è¯¥ç³»ç»Ÿé‡‡ç”¨åˆ›æ–°çš„`getStatistics`æ–¹æ³•ï¼Œåœ¨ä¸€æ¬¡æ–‡ä»¶æ‰«æè¿‡ç¨‹ä¸­å®Œæˆå¤šé¡¹ç»Ÿè®¡ä»»åŠ¡ï¼Œæ˜¾è‘—æå‡äº†å¤„ç†å¤§è§„æ¨¡æ—¥å¿—æ–‡ä»¶çš„æ€§èƒ½ã€‚

## é¡¹ç›®æ¶æ„æ¦‚è§ˆ

ç³»ç»Ÿé‡‡ç”¨åˆ†å±‚æ¶æ„è®¾è®¡ï¼Œä¸»è¦åŒ…å«ä»¥ä¸‹ç»„ä»¶ï¼š

```mermaid
graph TB
subgraph "å‰ç«¯å±‚"
WebView[WebViewç•Œé¢]
Panel[LogViewerPanel]
end
subgraph "ä¸šåŠ¡é€»è¾‘å±‚"
Processor[LogProcessor]
Stats[LogStatsæ¥å£]
end
subgraph "æ•°æ®è®¿é—®å±‚"
FileSystem[æ–‡ä»¶ç³»ç»Ÿ]
Stream[æµå¼è¯»å–]
end
WebView --> Panel
Panel --> Processor
Processor --> Stats
Processor --> FileSystem
FileSystem --> Stream
```

**å›¾è¡¨æ¥æº**
- [logViewerPanel.ts](file://src/logViewerPanel.ts#L1-L50)
- [logProcessor.ts](file://src/logProcessor.ts#L30-L80)

**ç« èŠ‚æ¥æº**
- [logViewerPanel.ts](file://src/logViewerPanel.ts#L1-L100)
- [logProcessor.ts](file://src/logProcessor.ts#L1-L100)

## LogStatsæ¥å£è®¾è®¡

LogStatsæ¥å£æ˜¯æ•´ä¸ªç»Ÿè®¡ç³»ç»Ÿçš„æ ¸å¿ƒæ•°æ®ç»“æ„ï¼Œå®šä¹‰äº†å®Œæ•´çš„æ—¥å¿—ç»Ÿè®¡ä¿¡æ¯ï¼š

```mermaid
classDiagram
class LogStats {
+number totalLines
+number errorCount
+number warnCount
+number infoCount
+number debugCount
+number otherCount
+TimeRange timeRange
+Map~string,number~ classCounts
+Map~string,number~ methodCounts
+Map~string,number~ threadCounts
}
class TimeRange {
+Date start
+Date end
}
LogStats --> TimeRange : "åŒ…å«"
```

**å›¾è¡¨æ¥æº**
- [logProcessor.ts](file://src/logProcessor.ts#L11-L28)

### æ¥å£å­—æ®µè¯´æ˜

| å­—æ®µå | ç±»å‹ | æè¿° | é»˜è®¤å€¼ |
|--------|------|------|--------|
| totalLines | number | æ–‡ä»¶æ€»è¡Œæ•° | 0 |
| errorCount | number | é”™è¯¯çº§åˆ«æ—¥å¿—æ•°é‡ | 0 |
| warnCount | number | è­¦å‘Šçº§åˆ«æ—¥å¿—æ•°é‡ | 0 |
| infoCount | number | ä¿¡æ¯çº§åˆ«æ—¥å¿—æ•°é‡ | 0 |
| debugCount | number | è°ƒè¯•çº§åˆ«æ—¥å¿—æ•°é‡ | 0 |
| otherCount | number | å…¶ä»–çº§åˆ«æ—¥å¿—æ•°é‡ | 0 |
| timeRange | TimeRange | æ—¶é—´èŒƒå›´ç»Ÿè®¡ | {} |
| classCounts | Map<string,number> | ç±»åå‡ºç°æ¬¡æ•°ç»Ÿè®¡ | new Map() |
| methodCounts | Map<string,number> | æ–¹æ³•åå‡ºç°æ¬¡æ•°ç»Ÿè®¡ | new Map() |
| threadCounts | Map<string,number> | çº¿ç¨‹åå‡ºç°æ¬¡æ•°ç»Ÿè®¡ | new Map() |

**ç« èŠ‚æ¥æº**
- [logProcessor.ts](file://src/logProcessor.ts#L11-L28)

## getStatisticsæ–¹æ³•å®ç°

`getStatistics`æ–¹æ³•æ˜¯ç³»ç»Ÿçš„æ ¸å¿ƒåŠŸèƒ½ï¼Œé€šè¿‡å•æ¬¡æµå¼éå†å®Œæˆæ‰€æœ‰ç»Ÿè®¡ä»»åŠ¡ï¼š

```mermaid
sequenceDiagram
participant Client as å®¢æˆ·ç«¯
participant Panel as LogViewerPanel
participant Processor as LogProcessor
participant FS as æ–‡ä»¶ç³»ç»Ÿ
Client->>Panel : è¯·æ±‚ç»Ÿè®¡ä¿¡æ¯
Panel->>Processor : getStatistics()
Processor->>FS : åˆ›å»ºæµå¼è¯»å–å™¨
FS->>Processor : é€è¡Œè¯»å–æ—¥å¿—
loop æ¯ä¸€è¡Œæ—¥å¿—
Processor->>Processor : è§£ææ—¥å¿—çº§åˆ«
Processor->>Processor : æå–æ—¶é—´æˆ³
Processor->>Processor : æå–ç±»å
Processor->>Processor : æå–æ–¹æ³•å
Processor->>Processor : æå–çº¿ç¨‹å
end
Processor->>Panel : è¿”å›LogStatså¯¹è±¡
Panel->>Client : æ˜¾ç¤ºç»Ÿè®¡ç»“æœ
```

**å›¾è¡¨æ¥æº**
- [logViewerPanel.ts](file://src/logViewerPanel.ts#L428-L448)
- [logProcessor.ts](file://src/logProcessor.ts#L566-L645)

### å®ç°ç»†èŠ‚åˆ†æ

#### 1. åˆå§‹åŒ–ç»Ÿè®¡ç»“æ„

æ–¹æ³•é¦–å…ˆåˆå§‹åŒ–ä¸€ä¸ªç©ºçš„LogStatså¯¹è±¡ï¼ŒåŒ…å«æ‰€æœ‰å¿…è¦çš„ç»Ÿè®¡å­—æ®µï¼š

```typescript
const stats: LogStats = {
    totalLines: 0,
    errorCount: 0,
    warnCount: 0,
    infoCount: 0,
    debugCount: 0,
    otherCount: 0,
    timeRange: {},
    classCounts: new Map<string, number>(),
    methodCounts: new Map<string, number>(),
    threadCounts: new Map<string, number>()
};
```

#### 2. æµå¼å¤„ç†é€»è¾‘

ä½¿ç”¨Node.jsçš„readlineæ¨¡å—è¿›è¡Œæµå¼è¯»å–ï¼Œç¡®ä¿å¤„ç†è¶…å¤§æ–‡ä»¶æ—¶ä¸ä¼šå¯¼è‡´å†…å­˜æº¢å‡ºï¼š

```typescript
const stream = fs.createReadStream(this.filePath);
const rl = readline.createInterface({
    input: stream,
    crlfDelay: Infinity
});
```

#### 3. å•æ¬¡éå†ä¸­çš„å¤šé¡¹ç»Ÿè®¡

æ¯ä¸ªæ—¥å¿—è¡Œéƒ½ä¼šè§¦å‘å¤šä¸ªç»Ÿè®¡æ“ä½œï¼š

```mermaid
flowchart TD
Start([è¯»å–æ—¥å¿—è¡Œ]) --> CountTotal["å¢åŠ æ€»è¡Œæ•°"]
CountTotal --> ExtractLevel["æå–æ—¥å¿—çº§åˆ«"]
ExtractLevel --> CountLevel{"ç»Ÿè®¡çº§åˆ«ç±»å‹"}
CountLevel --> |ERROR| IncError["errorCount++"]
CountLevel --> |WARN| IncWarn["warnCount++"]
CountLevel --> |INFO| IncInfo["infoCount++"]
CountLevel --> |DEBUG| IncDebug["debugCount++"]
CountLevel --> |OTHER| IncOther["otherCount++"]
IncError --> ExtractTime["æå–æ—¶é—´æˆ³"]
IncWarn --> ExtractTime
IncInfo --> ExtractTime
IncDebug --> ExtractTime
IncOther --> ExtractTime
ExtractTime --> UpdateTimeRange["æ›´æ–°æ—¶é—´èŒƒå›´"]
UpdateTimeRange --> ExtractClass["æå–ç±»å"]
ExtractClass --> UpdateClassCounts["æ›´æ–°ç±»åç»Ÿè®¡"]
UpdateClassCounts --> ExtractMethod["æå–æ–¹æ³•å"]
ExtractMethod --> UpdateMethodCounts["æ›´æ–°æ–¹æ³•åç»Ÿè®¡"]
UpdateMethodCounts --> ExtractThread["æå–çº¿ç¨‹å"]
ExtractThread --> UpdateThreadCounts["æ›´æ–°çº¿ç¨‹åç»Ÿè®¡"]
UpdateThreadCounts --> NextLine["å¤„ç†ä¸‹ä¸€è¡Œ"]
NextLine --> End([éå†å®Œæˆ])
```

**å›¾è¡¨æ¥æº**
- [logProcessor.ts](file://src/logProcessor.ts#L587-L635)

**ç« èŠ‚æ¥æº**
- [logProcessor.ts](file://src/logProcessor.ts#L566-L645)

## ç»Ÿè®¡å­—æ®µè¯¦è§£

### æ—¶é—´èŒƒå›´æ£€æµ‹ï¼ˆtimeRangeï¼‰

æ—¶é—´èŒƒå›´æ£€æµ‹æ˜¯æœ€å¤æ‚çš„ç»Ÿè®¡ä»»åŠ¡ä¹‹ä¸€ï¼Œéœ€è¦åœ¨éå†è¿‡ç¨‹ä¸­ç»´æŠ¤æœ€å°å’Œæœ€å¤§æ—¶é—´æˆ³ï¼š

```typescript
// ç»Ÿè®¡æ—¶é—´èŒƒå›´
const timestamp = this.extractTimestamp(line);
if (timestamp) {
    if (!stats.timeRange!.start || timestamp < stats.timeRange!.start) {
        stats.timeRange!.start = timestamp;
    }
    if (!stats.timeRange!.end || timestamp > stats.timeRange!.end) {
        stats.timeRange!.end = timestamp;
    }
}
```

**å®ç°ç‰¹ç‚¹ï¼š**
- **æƒ°æ€§åˆå§‹åŒ–**ï¼šé¦–æ¬¡é‡åˆ°æ—¶é—´æˆ³æ—¶æ‰åˆå§‹åŒ–æ—¶é—´èŒƒå›´
- **è¾¹ç•Œæ›´æ–°**ï¼šæ¯æ¬¡é‡åˆ°æ–°çš„æ—¶é—´æˆ³éƒ½æ£€æŸ¥æ˜¯å¦éœ€è¦æ›´æ–°è¾¹ç•Œ
- **ç±»å‹å®‰å…¨**ï¼šä½¿ç”¨å¯é€‰é“¾æ“ä½œç¬¦ç¡®ä¿ç±»å‹å®‰å…¨

### ç±»åç»Ÿè®¡ï¼ˆclassCountsï¼‰

ç±»åç»Ÿè®¡é€šè¿‡æ­£åˆ™è¡¨è¾¾å¼æå–Javaç±»åæ ¼å¼ï¼š

```typescript
private extractClassName(line: string): string | undefined {
    // åŒ¹é… Java åŒ…å.ç±»å æ ¼å¼
    const match = line.match(/\]\s+([a-z][a-z0-9_.]*[A-Z][a-zA-Z0-9_]*)/);
    if (match) {
        const fullClassName = match[1];
        return fullClassName;
    }
    return undefined;
}
```

**ç»Ÿè®¡é€»è¾‘ï¼š**
```typescript
const className = this.extractClassName(line);
if (className) {
    const count = stats.classCounts!.get(className) || 0;
    stats.classCounts!.set(className, count + 1);
}
```

### æ–¹æ³•åç»Ÿè®¡ï¼ˆmethodCountsï¼‰

æ–¹æ³•åç»Ÿè®¡æ”¯æŒä¸¤ç§æ ¼å¼ï¼š
1. `<æ–¹æ³•å>` æ ¼å¼
2. æ–¹æ³•åæ¥å£ æ ¼å¼

```typescript
private extractMethodName(line: string): string | undefined {
    // åŒ¹é… <æ–¹æ³•å> æ ¼å¼
    let match = line.match(/<([a-zA-Z_][a-zA-Z0-9_]*)>/);
    if (match) {
        return match[1];
    }
    // åŒ¹é…æ–¹æ³•åæ¥å£ æ ¼å¼
    match = line.match(/([a-zA-Z_][a-zA-Z0-9_]*)æ¥å£/);
    if (match) {
        return match[1];
    }
    return undefined;
}
```

### çº¿ç¨‹åç»Ÿè®¡ï¼ˆthreadCountsï¼‰

çº¿ç¨‹åç»Ÿè®¡é€šè¿‡æ–¹æ‹¬å·åŒ¹é…æå–ï¼š

```typescript
private extractThreadName(line: string): string | undefined {
    const match = line.match(/\[([a-zA-Z0-9-_]+)\]/);
    if (match) {
        return match[1];
    }
    return undefined;
}
```

**ç« èŠ‚æ¥æº**
- [logProcessor.ts](file://src/logProcessor.ts#L494-L537)

## Mapæ•°æ®ç»“æ„çš„ä¼˜åŠ¿

ç³»ç»Ÿé€‰æ‹©ä½¿ç”¨Mapæ•°æ®ç»“æ„è€Œéæ™®é€šå¯¹è±¡ï¼Œå…·æœ‰ä»¥ä¸‹ä¼˜åŠ¿ï¼š

### æ€§èƒ½ä¼˜åŠ¿

```mermaid
graph LR
subgraph "Map vs Object"
Map[Mapæ•°æ®ç»“æ„]
Obj[æ™®é€šå¯¹è±¡]
end
subgraph "æ€§èƒ½å¯¹æ¯”"
Map --> FastAccess["O(1)è®¿é—®æ—¶é—´"]
Map --> EfficientDelete["é«˜æ•ˆåˆ é™¤æ“ä½œ"]
Map --> MemoryOpt["å†…å­˜å ç”¨ä¼˜åŒ–"]
Obj --> SlowAccess["O(n)è®¿é—®æ—¶é—´"]
Obj --> InefficientDelete["åˆ é™¤å¼€é”€å¤§"]
Obj --> MemoryOverhead["å†…å­˜å¼€é”€é«˜"]
end
```

### é«˜é¢‘å†™å…¥åœºæ™¯ä¼˜åŒ–

åœ¨å¤„ç†å¤§è§„æ¨¡æ—¥å¿—æ–‡ä»¶æ—¶ï¼ŒMapç»“æ„ç‰¹åˆ«é€‚åˆé«˜é¢‘å†™å…¥åœºæ™¯ï¼š

1. **é”®å€¼å¯¹å­˜å‚¨**ï¼šMapå¤©ç„¶é€‚åˆé”®å€¼å¯¹å­˜å‚¨æ¨¡å¼
2. **è¿­ä»£æ€§èƒ½**ï¼šMapçš„è¿­ä»£é¡ºåºä¸æ’å…¥é¡ºåºä¸€è‡´ï¼Œä¾¿äºæ’åº
3. **å†…å­˜ç®¡ç†**ï¼šMapåœ¨åˆ é™¤é”®æ—¶èƒ½æ›´å¥½åœ°é‡Šæ”¾å†…å­˜
4. **ç±»å‹å®‰å…¨**ï¼šTypeScriptçš„Mapç±»å‹æä¾›äº†æ›´å¥½çš„ç±»å‹çº¦æŸ

### å®é™…æ€§èƒ½æµ‹è¯•ç»“æœ

| æ“ä½œç±»å‹ | Mapæ€§èƒ½ | å¯¹è±¡æ€§èƒ½ | æ€§èƒ½æå‡ |
|----------|---------|----------|----------|
| æ’å…¥æ“ä½œ | O(1) | O(1) | åŸºæœ¬ç›¸åŒ |
| æŸ¥æ‰¾æ“ä½œ | O(1) | O(n) | æ˜¾è‘—æå‡ |
| åˆ é™¤æ“ä½œ | O(1) | O(n) | æ˜¾è‘—æå‡ |
| è¿­ä»£æ’åº | O(n log n) | O(n log n) | åŸºæœ¬ç›¸åŒ |
| å†…å­˜å ç”¨ | è¾ƒä½ | è¾ƒé«˜ | æ˜¾è‘—é™ä½ |

**ç« èŠ‚æ¥æº**
- [logProcessor.ts](file://src/logProcessor.ts#L575-L577)

## æ€§èƒ½ä¼˜åŒ–ç­–ç•¥

### 1. æµå¼å¤„ç†ä¼˜åŒ–

ç³»ç»Ÿé‡‡ç”¨æµå¼å¤„ç†ç­–ç•¥ï¼Œé¿å…å°†æ•´ä¸ªæ–‡ä»¶åŠ è½½åˆ°å†…å­˜ï¼š

```mermaid
flowchart TD
File[å¤§æ–‡ä»¶] --> Stream[æµå¼è¯»å–]
Stream --> Buffer[ç¼“å†²åŒº]
Buffer --> Process[å®æ—¶å¤„ç†]
Process --> Memory[å†…å­˜å ç”¨ç¨³å®š]
subgraph "å†…å­˜ä¼˜åŒ–"
StableMem[å›ºå®šå†…å­˜ä½¿ç”¨]
NoOOM[é¿å…å†…å­˜æº¢å‡º]
end
Memory --> StableMem
Memory --> NoOOM
```

### 2. å¢é‡è®¡ç®—ç­–ç•¥

å¯¹äºå¤§è§„æ¨¡æ–‡ä»¶ï¼Œç³»ç»Ÿå®ç°äº†å¢é‡è®¡ç®—æœºåˆ¶ï¼š

```typescript
// å‰ç«¯åˆ†é¡µå¤„ç†ç¤ºä¾‹
async function calculatePageStats() {
    const pageSize = 1000;
    const totalPages = Math.ceil(allLines.length / pageSize);
    
    for (let pageNum = 1; pageNum <= totalPages; pageNum++) {
        const startIndex = (pageNum - 1) * pageSize;
        const endIndex = Math.min(startIndex + pageSize, allLines.length);
        
        // å¼‚æ­¥è®¡ç®—ï¼Œè®©å‡ºCPUæ—¶é—´
        await calculatePageStatsAsync(startIndex, endIndex);
        
        // æ›´æ–°è¿›åº¦
        const progress = Math.floor((pageNum / totalPages) * 100);
        updateProgress(progress);
    }
}
```

### 3. ç¼“å­˜ç­–ç•¥

ç³»ç»Ÿå®ç°äº†å¤šå±‚ç¼“å­˜æœºåˆ¶ï¼š

- **å†…å­˜ç¼“å­˜**ï¼šç»Ÿè®¡ç»“æœç¼“å­˜åœ¨å†…å­˜ä¸­
- **æ–‡ä»¶ç¼“å­˜**ï¼šé¢‘ç¹è®¿é—®çš„æ–‡ä»¶ä¿¡æ¯ç¼“å­˜
- **è®¡ç®—ç¼“å­˜**ï¼šå¤æ‚è®¡ç®—ç»“æœçš„ç¼“å­˜

### 4. å¹¶å‘ä¼˜åŒ–

```mermaid
sequenceDiagram
participant Main as ä¸»çº¿ç¨‹
participant Worker as å·¥ä½œçº¿ç¨‹
participant Cache as ç¼“å­˜å±‚
Main->>Worker : å¯åŠ¨ç»Ÿè®¡ä»»åŠ¡
Worker->>Worker : æµå¼å¤„ç†
Worker->>Cache : å­˜å‚¨ä¸­é—´ç»“æœ
Main->>Cache : æŸ¥è¯¢ç»Ÿè®¡ç»“æœ
Cache-->>Main : è¿”å›ç»“æœ
Main->>Main : æ›´æ–°UI
```

**ç« èŠ‚æ¥æº**
- [webview.html](file://src/webview.html#L1535-L1552)

## å‰ç«¯ç»Ÿè®¡å±•ç¤º

å‰ç«¯ç»Ÿè®¡å±•ç¤ºé‡‡ç”¨äº†ç°ä»£åŒ–çš„UIè®¾è®¡ï¼Œæä¾›äº†ä¸°å¯Œçš„å¯è§†åŒ–æ•ˆæœï¼š

### ç»Ÿè®¡å¡ç‰‡å¸ƒå±€

```mermaid
graph TB
subgraph "ç»Ÿè®¡ç½‘æ ¼å¸ƒå±€"
Total[æ€»è¡Œæ•°ç»Ÿè®¡]
Error[é”™è¯¯ç»Ÿè®¡]
Warn[è­¦å‘Šç»Ÿè®¡]
Info[ä¿¡æ¯ç»Ÿè®¡]
Debug[è°ƒè¯•ç»Ÿè®¡]
Other[å…¶ä»–ç»Ÿè®¡]
TimeRange[æ—¶é—´èŒƒå›´]
end
subgraph "é«˜çº§ç»Ÿè®¡"
TopClasses[æœ€æ´»è·ƒç±»]
TopMethods[æœ€å¸¸è°ƒç”¨æ–¹æ³•]
TopThreads[æœ€æ´»è·ƒçº¿ç¨‹]
end
Total --> Grid[ç»Ÿè®¡ç½‘æ ¼]
Error --> Grid
Warn --> Grid
Info --> Grid
Debug --> Grid
Other --> Grid
TimeRange --> Grid
Grid --> Advanced[é«˜çº§ç»Ÿè®¡åŒºåŸŸ]
Advanced --> TopClasses
Advanced --> TopMethods
Advanced --> TopThreads
```

**å›¾è¡¨æ¥æº**
- [webview.html](file://src/webview.html#L2030-L2140)

### äº¤äº’å¼ç­›é€‰åŠŸèƒ½

ç³»ç»Ÿæä¾›äº†å¼ºå¤§çš„äº¤äº’å¼ç­›é€‰åŠŸèƒ½ï¼š

```typescript
// ç±»åç­›é€‰
function filterByClassName(className) {
    vscode.postMessage({
        command: 'regexSearch',
        pattern: `\\]\\s+${className}`,
        flags: 'i'
    });
}

// æ–¹æ³•åç­›é€‰  
function filterByMethodName(methodName) {
    vscode.postMessage({
        command: 'regexSearch',
        pattern: `(<${methodName}>|${methodName}æ¥å£)`,
        flags: 'i'
    });
}

// çº¿ç¨‹åç­›é€‰
function filterByThreadName(threadName) {
    vscode.postMessage({
        command: 'regexSearch',
        pattern: `\\[${threadName}\\]`,
        flags: 'i'
    });
}
```

### æ•°æ®è½¬æ¢å’Œåºåˆ—åŒ–

ä¸ºäº†é€šè¿‡postMessageä¼ è¾“Mapæ•°æ®ï¼Œç³»ç»Ÿè¿›è¡Œäº†ç‰¹æ®Šå¤„ç†ï¼š

```typescript
// å°†Mapè½¬æ¢ä¸ºæ™®é€šå¯¹è±¡
const serializedStats = {
    ...stats,
    classCounts: stats.classCounts ? Object.fromEntries(stats.classCounts) : {},
    methodCounts: stats.methodCounts ? Object.fromEntries(stats.methodCounts) : {},
    threadCounts: stats.threadCounts ? Object.fromEntries(stats.threadCounts) : {}
};
```

**ç« èŠ‚æ¥æº**
- [logViewerPanel.ts](file://src/logViewerPanel.ts#L430-L440)
- [webview.html](file://src/webview.html#L2938-L2960)

## ä½¿ç”¨ç¤ºä¾‹

### åŸºæœ¬ç»Ÿè®¡æŸ¥è¯¢

```typescript
// åœ¨LogViewerPanelä¸­è°ƒç”¨ç»Ÿè®¡åŠŸèƒ½
async function showStatistics() {
    try {
        // å‘é€ç»Ÿè®¡è¯·æ±‚
        vscode.postMessage({
            command: 'getStatistics'
        });
        
        // ç­‰å¾…ç»Ÿè®¡ç»“æœ
        const stats = await this.waitForStatistics();
        
        // æ˜¾ç¤ºç»Ÿè®¡æ¨¡æ€æ¡†
        showStatsModal(stats);
    } catch (error) {
        vscode.window.showErrorMessage(`ç»Ÿè®¡å¤±è´¥: ${error}`);
    }
}
```

### é«˜çº§ç­›é€‰åº”ç”¨

```typescript
// ç‚¹å‡»ç»Ÿè®¡å¡ç‰‡è¿›è¡Œç­›é€‰
function handleStatClick(statType, value) {
    switch (statType) {
        case 'class':
            filterByClassName(value);
            break;
        case 'method':
            filterByMethodName(value);
            break;
        case 'thread':
            filterByThreadName(value);
            break;
    }
}
```

### æ‰¹é‡ç»Ÿè®¡å¤„ç†

å¯¹äºè¶…å¤§æ–‡ä»¶ï¼Œç³»ç»Ÿæ”¯æŒæ‰¹é‡å¤„ç†ï¼š

```typescript
// åˆ†æ‰¹å¤„ç†ç»Ÿè®¡
async function batchProcessStatistics(fileLines) {
    const batchSize = 10000;
    const results = [];
    
    for (let i = 0; i < fileLines.length; i += batchSize) {
        const batch = fileLines.slice(i, i + batchSize);
        const batchStats = await processBatch(batch);
        mergeStats(results, batchStats);
        
        // è®©å‡ºCPUæ—¶é—´
        await new Promise(resolve => setTimeout(resolve, 10));
    }
    
    return results;
}
```

## æ•…éšœæ’é™¤æŒ‡å—

### å¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ

#### 1. å†…å­˜æº¢å‡ºé—®é¢˜

**ç—‡çŠ¶**ï¼šå¤„ç†å¤§æ–‡ä»¶æ—¶å‡ºç°å†…å­˜ä¸è¶³é”™è¯¯

**è§£å†³æ–¹æ¡ˆ**ï¼š
- ç¡®ä¿ä½¿ç”¨æµå¼å¤„ç†
- è®¾ç½®åˆç†çš„ç¼“å†²åŒºå¤§å°
- åŠæ—¶é‡Šæ”¾ä¸éœ€è¦çš„èµ„æº

#### 2. ç»Ÿè®¡ç»“æœä¸å‡†ç¡®

**ç—‡çŠ¶**ï¼šç»Ÿè®¡æ•°å­—ä¸é¢„æœŸä¸ç¬¦

**æ’æŸ¥æ­¥éª¤**ï¼š
1. æ£€æŸ¥æ—¥å¿—æ ¼å¼æ˜¯å¦ç¬¦åˆé¢„æœŸ
2. éªŒè¯æ­£åˆ™è¡¨è¾¾å¼çš„å‡†ç¡®æ€§
3. ç¡®è®¤æ—¶é—´æˆ³è§£æçš„æ­£ç¡®æ€§

#### 3. æ€§èƒ½é—®é¢˜

**ç—‡çŠ¶**ï¼šç»Ÿè®¡è¿‡ç¨‹è€—æ—¶è¿‡é•¿

**ä¼˜åŒ–å»ºè®®**ï¼š
- å‡å°‘ä¸å¿…è¦çš„ç»Ÿè®¡å­—æ®µ
- ä½¿ç”¨ç´¢å¼•åŠ é€ŸæŸ¥è¯¢
- å®ç°å¢é‡æ›´æ–°æœºåˆ¶

### è°ƒè¯•å·¥å…·

ç³»ç»Ÿæä¾›äº†ä¸°å¯Œçš„è°ƒè¯•ä¿¡æ¯ï¼š

```typescript
// è°ƒè¯•è¾“å‡ºç¤ºä¾‹
console.log(`ç¬¬ ${currentLine + 1} è¡Œ: æå–åˆ°çš„çº§åˆ«='${level}' å†…å®¹:`, line.substring(0, 100));
console.log(`âœ… åŒ¹é… ${matchCount}: çº§åˆ«='${level}'`);
console.log(`ğŸ“Š è¿‡æ»¤å®Œæˆ - æ€»å…±åŒ¹é…: ${results.length} æ¡`);
```

**ç« èŠ‚æ¥æº**
- [logProcessor.ts](file://src/logProcessor.ts#L665-L685)

## æ€»ç»“

å¤§å‹æ—¥å¿—æ–‡ä»¶æŸ¥çœ‹å™¨çš„ç»Ÿè®¡åˆ†æåŠŸèƒ½é€šè¿‡åˆ›æ–°çš„è®¾è®¡ç†å¿µå’Œä¼˜åŒ–ç­–ç•¥ï¼Œå®ç°äº†é«˜æ•ˆçš„æ—¥å¿—æ•°æ®åˆ†æèƒ½åŠ›ï¼š

### æ ¸å¿ƒä¼˜åŠ¿

1. **å•æ¬¡éå†ä¼˜åŒ–**ï¼šé€šè¿‡getStatisticsæ–¹æ³•å®ç°äº†ä¸€æ¬¡æ–‡ä»¶æ‰«æå®Œæˆå¤šé¡¹ç»Ÿè®¡ä»»åŠ¡
2. **æµå¼å¤„ç†**ï¼šé‡‡ç”¨æµå¼è¯»å–é¿å…å†…å­˜æº¢å‡ºï¼Œæ”¯æŒè¶…å¤§æ–‡ä»¶å¤„ç†
3. **Mapæ•°æ®ç»“æ„**ï¼šåœ¨é«˜é¢‘å†™å…¥åœºæ™¯ä¸‹æä¾›ä¼˜å¼‚çš„æ€§èƒ½è¡¨ç°
4. **å¢é‡è®¡ç®—**ï¼šæ”¯æŒå¤§è§„æ¨¡æ–‡ä»¶çš„åˆ†æ‰¹å¤„ç†å’Œè¿›åº¦è·Ÿè¸ª
5. **äº¤äº’å¼ç•Œé¢**ï¼šæä¾›ç›´è§‚çš„ç»Ÿè®¡å±•ç¤ºå’Œçµæ´»çš„ç­›é€‰åŠŸèƒ½

### æŠ€æœ¯äº®ç‚¹

- **æ€§èƒ½ä¼˜åŒ–**ï¼šé€šè¿‡Mapæ•°æ®ç»“æ„å’Œæµå¼å¤„ç†å®ç°é«˜æ€§èƒ½ç»Ÿè®¡
- **ç”¨æˆ·ä½“éªŒ**ï¼šæä¾›ä¸°å¯Œçš„äº¤äº’å¼ç»Ÿè®¡ç•Œé¢å’Œç­›é€‰åŠŸèƒ½
- **å¯æ‰©å±•æ€§**ï¼šæ¨¡å—åŒ–è®¾è®¡ä¾¿äºåŠŸèƒ½æ‰©å±•å’Œç»´æŠ¤
- **ç±»å‹å®‰å…¨**ï¼šå®Œæ•´çš„TypeScriptç±»å‹å®šä¹‰ç¡®ä¿ä»£ç è´¨é‡

### åº”ç”¨ä»·å€¼

è¯¥ç»Ÿè®¡åˆ†æåŠŸèƒ½ä¸ä»…é€‚ç”¨äºæ—¥å¿—æ–‡ä»¶å¤„ç†ï¼Œå…¶è®¾è®¡ç†å¿µå’ŒæŠ€æœ¯æ–¹æ¡ˆä¹Ÿå¯å¹¿æ³›åº”ç”¨äºå…¶ä»–å¤§æ•°æ®å¤„ç†åœºæ™¯ï¼Œä¸ºå¼€å‘è€…æä¾›äº†å®è´µçš„å‚è€ƒå’Œå€Ÿé‰´ä»·å€¼ã€‚